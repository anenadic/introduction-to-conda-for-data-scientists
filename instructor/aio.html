<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Introduction to Conda for (Data) Scientists: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Introduction to Conda for (Data) Scientists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Introduction to Conda for (Data) Scientists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Conda for (Data) Scientists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-getting-started-with-conda.html">1. Getting Started with Conda</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-working-with-environments.html">2. Working with Environments</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-using-packages-and-channels.html">3. Using Packages and Channels</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-sharing-environments.html">4. Sharing Environments</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-managing-cuda-dependencies.html">5. Managing GPU dependencies</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="reference.html">Glossary</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-getting-started-with-conda"><p>Content from <a href="01-getting-started-with-conda.html">Getting Started with Conda</a></p>
<hr>
<p>Last updated on 2024-11-14 |

        <a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/edit/main/episodes/01-getting-started-with-conda.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Conda?</li>
<li>Why should I use a package and environment management system as part
of my research workflow?</li>
<li>Why use Conda ?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand why you should use a package and environment management
system as part of your (data) science workflow.</li>
<li>Explain the benefits of using Conda as part of your (data) science
workflow.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="packages-and-environments">Packages and Environments<a class="anchor" aria-label="anchor" href="#packages-and-environments"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h3>
<p>When working with a programming language, such as Python, that can do
almost <em>anything</em>, one has to wonder how this is possible. You
download Python, it has about 25 MB, how can everthing be included in
this small data package. The answer is - it is not. Python, as well as
many other programming languages use external libraries or packages for
being able to doing almost <em>anything</em>. You can see this already
when you start programming. After learning some very basics, you often
learn how to <em>import</em> something into your script or session.</p>
<div id="modules-packages-libraries" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="modules-packages-libraries" class="callout-inner">
<h3 class="callout-title">Modules, packages, libraries</h3>
<div class="callout-content">
<ul>
<li>Module: a collection of functions and variables, as in a script</li>
<li>Package: a collection of modules with an <strong>init</strong>.py
file (can be empty), as in a directory with scripts</li>
<li>Library: a collection of packages with realted functionality</li>
</ul>
<p>Library/Package are often used interchangeably.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h3>
<p>A bit further into your programming career you may notice/have
noticed that many packages do not just do everything on their own.
Instead, they <em>depend</em> on other packages for their functionality.
For example, the <a href="https://www.scipy.org/about.html" class="external-link">Scipy
package</a> is used for numerical routines. To not reinvent the wheel,
the package makes use of other packages, such as numpy (numerical
python) and matplotlib (plotting) and many more. So we say that numpy
and matplotlib are <em>dependencies</em> of Scipy.</p>
<p>Many packages are being further developed all the time, generating
different <em>versions</em> of packages. During development it may
happen that a function call changes and/or functionalities are added or
removed. If one package can depend on another, this may create issues.
Therefore it is not only important to know that e.g. Scipy depends on
numpy and matplotlib, but also that it depends on numpy version &gt;=
1.6 and matplotlib version &gt;= 1.1. Numpy version 1.5 in this case
would not be sufficient.</p>
</div>
<div class="section level3">
<h3 id="environments">Environments<a class="anchor" aria-label="anchor" href="#environments"></a>
</h3>
<p>When starting with programming we may not use many packages yet and
the installation may be straightforward. But for most people, there
comes a time when one version of a package or also the programming
language is not enough anymore. You may find an older tool that depends
on an older version of your programming language (e.g. Pyhton 2.7), but
many of your other tools depend on a newer version (e.g. Python 3.6).
You could now start up another computer or virtual machine to run the
other version of the programming language, but this is not very handy,
since you may want to use the tools together in a workflow later on.
Here, <em>environments</em> are one solution to the problem. Nowadays
there are several environment management systems following a similar
idea: Instead of having to use multiple computers or virtual machines to
run different versions of the same package, you can install packages in
isolated environments.</p>
</div>
<div class="section level3">
<h3 id="environment-management">Environment management<a class="anchor" aria-label="anchor" href="#environment-management"></a>
</h3>
<p>An environment management system solves a number of problems commonly
encountered by (data) scientists.</p>
<ul>
<li>An application you need for a research project requires different
versions of your base programming language or different versions of
various third-party packages from the versions that you are currently
using.</li>
<li>An application you developed as part of a previous research project
that worked fine on your system six months ago now no longer works.</li>
<li>Code that was written for a joint research project works on your
machine but not on your collaborators’ machines.</li>
<li>An application that you are developing on your local machine doesn’t
provide the same results when run on your remote cluster.</li>
</ul>
<p>An environment management system enables you to set up a new, project
specific software environment containing specific Python versions as
well as the versions of additional packages and required dependencies
that are all mutually compatible.</p>
<ul>
<li>Environment management systems help resolve dependency issues by
allowing you to use different versions of a package for different
projects.</li>
<li>Make your projects self-contained and reproducible by capturing all
package dependencies in a single requirements file.</li>
<li>Allow you to install packages on a host on which you do not have
admin privileges.</li>
</ul>
<div id="environment-management-systems-for-python" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="environment-management-systems-for-python" class="callout-inner">
<h3 class="callout-title">Environment management systems for Python</h3>
<div class="callout-content">
<p>Conda is not the only way; Python for example has many more ways of
working with environments:</p>
<ul>
<li><a href="https://virtualenv.pypa.io/en/latest/" class="external-link">virtualenv</a></li>
<li><a href="https://pipenv.pypa.io/en/latest/" class="external-link">pipenv</a></li>
<li><a href="https://docs.python.org/3/library/venv.html" class="external-link">venv</a></li>
<li><a href="https://github.com/pyenv/pyenv" class="external-link">pyenv</a></li>
<li>…</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="package-management">Package management<a class="anchor" aria-label="anchor" href="#package-management"></a>
</h3>
<p>A good package management system greatly simplifies the process of
installing software by…</p>
<ol style="list-style-type: decimal">
<li>identifying and installing compatible versions of software and all
required dependencies.</li>
<li>handling the process of updating software as more recent versions
become available.</li>
</ol>
<p>If you use some flavor of Linux, then you are probably familiar with
the package manager for your Linux distribution (i.e., <code>apt</code>
on Ubuntu, <code>yum</code> on CentOS); if you are a Mac OSX user then
you might be familiar with the <a href="https://brew.sh/" class="external-link">Home Brew
Project</a> which brings a Linux-like package management system to Mac
OS; if you are a Windows OS user, then you may not be terribly familiar
with package managers as there isn’t really a standard package manager
for Windows (although there is the <a href="https://chocolatey.org/" class="external-link">Chocolatey Project</a>).</p>
<p>Operating system package management tools are great but these tools
actually solve a more general problem than you often face as a (data)
scientist. As a (data) scientist you typically use one or two core
scripting languages (i.e., Python, R, SQL). Each scripting language has
multiple versions that can potentially be installed and each scripting
language will also have a large number of third-party packages that will
need to be installed. The exact version of your core scripting
language(s) and additional, third-party packages will also probably
change from project to project.</p>
<div id="package-management-systems-for-python" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="package-management-systems-for-python" class="callout-inner">
<h3 class="callout-title">Package management systems for Python</h3>
<div class="callout-content">
<p>Also here, Conda is not the only way; Python for example has many
more ways of working with packages:</p>
<ul>
<li><a href="https://pip.pypa.io/en/stable/" class="external-link">pip</a></li>
<li><a href="https://python-poetry.org/" class="external-link">Poetry</a></li>
<li>…</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="why-should-i-use-a-package-and-environment-management-system">Why should I use a package and environment management system?<a class="anchor" aria-label="anchor" href="#why-should-i-use-a-package-and-environment-management-system"></a>
</h2>
<hr class="half-width">
<p>Installing software is hard. Installing scientific software is often
even more challenging. In order to minimize the burden of installing and
updating software (data) scientists often install software packages that
they need for their various projects system-wide.</p>
<p>Installing software system-wide has a number of drawbacks:</p>
<ul>
<li>It can be difficult to figure out what software is required for any
particular research project.</li>
<li>It is often impossible to install different versions of the same
software package at the same time.</li>
<li>Updating software required for one project can often “break” the
software installed for another project.</li>
</ul>
<p>Put differently, installing software system-wide creates complex
dependencies between your research projects that shouldn’t really
exist!</p>
<p>Rather than installing software system-wide, wouldn’t it be great if
we could install software separately for each research project?</p>
<div id="discussion" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="discussion" class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>What are some of the <em>potential</em> benefits from installing
software separately for each project? What are some of the
<em>potential</em> costs?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>You may notice that many of the potential benefits from installing
software separately for each project require the ability to isolate the
projects’ software environments from one another (i.e., solve the
environment management problem). Once you have figured out how to
isolate project-specific software environments, you will still need to
have some way to manage software packages appropriately (i.e., solve the
package management problem).</p>
</div>
</div>
</div>
</div>
<p>What I hope you will have taken away from the discussion exercise is
an appreciation for the fact that in order to install project-specific
software environments you need to solve two complementary challenges:
environment management and package management.</p>
</section><section><h2 class="section-heading" id="conda">Conda<a class="anchor" aria-label="anchor" href="#conda"></a>
</h2>
<hr class="half-width">
<p>From the <a href="https://conda.io/projects/conda/en/latest/index.html" class="external-link">official
Conda documentation</a>. Conda is an open source package and environment
management system that runs on Windows, Mac OS and Linux.</p>
<ul>
<li>Conda can quickly install, run, and update packages and their
dependencies.</li>
<li>Conda can create, save, load, and switch between project specific
software environments on your local computer.</li>
<li>Although Conda was created for Python programs, Conda can package
and distribute software for any language such as R, Ruby, Lua, Scala,
Java, JavaScript, C, C++, FORTRAN.</li>
</ul>
<p>Conda as a <em>package manager</em> helps you find and install
packages. If you need a package that requires a different version of
Python, you do not need to switch to a different environment manager,
because Conda is also an <em>environment manager</em>. With just a few
commands, you can set up a totally separate environment to run that
different version of Python, while continuing to run your usual version
of Python in your normal environment.</p>
<div id="conda-vs.-miniconda-vs.-anaconda" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="conda-vs.-miniconda-vs.-anaconda" class="callout-inner">
<h3 class="callout-title">Conda vs. Miniconda vs. Anaconda</h3>
<div class="callout-content">
<p align="center">
<img alt="Conda vs. Miniconda vs. Anaconda" src="../fig/miniconda_vs_anaconda.png" width="500" class="figure"></p>
<p>Users are often confused about the differences between Conda,
Miniconda, and Anaconda. Conda is a tool for managing environments and
installing packages. Miniconda combines Conda with Python and a small
number of core packages; Anaconda includes Miniconda as well as a large
number of the most widely used Python packages.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="why-use-conda">Why use Conda?<a class="anchor" aria-label="anchor" href="#why-use-conda"></a>
</h2>
<hr class="half-width">
<p>Whilst there are many different package and environment management
systems that solve either the package management problem or the
environment management problem, Conda solves both of these problems and
explicitly targeted at (data) science use cases.</p>
<ul>
<li>Conda provides prebuilt packages, avoiding the need to deal with
compilers, or trying to work out how exactly to set up a specific tool.
Fields such as <a href="https://astroconda.readthedocs.io/en/latest/" class="external-link">Astronomy use conda
to distribute some of their most difficult-to-install tools such as
IRAF</a>. TensorFlow is another tool where to install it from source is
near impossible, but Conda makes this a single step.</li>
<li>Conda is cross platform, with support for Windows, MacOS, GNU/Linux,
and support for multiple hardware platforms, such as x86 and Power 8 and
9. In future lessons we will show how to make your environment
reproducible (<a href="https://www.nature.com/news/1-500-scientists-lift-the-lid-on-reproducibility-1.19970" class="external-link">reproducibility
being one of the major issues facing science</a>), and Conda allows you
to provide your environment to other people across these different
platforms.</li>
<li>Conda allows for using other package management tools (such as
<code>pip</code>) inside Conda environments, where a library or tools is
not already packaged for Conda (we’ll show later how to get access to
more conda packages via channels).</li>
</ul>
<p>Additionally, Anaconda provides commonly used data science libraries
and tools, such as R, NumPy, SciPy and TensorFlow built using optimised,
hardware specific libraries (such as Intel’s MKL or NVIDIA’s CUDA),
which provides a speedup without having to change any of your code.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Conda is a platform agnostic, open source package and environment
management system.</li>
<li>Using a package and environment management tool facilitates
portability and reproducibility of (data) science workflows.</li>
<li>Conda solves both the package and environment management problems
and targets multiple programming languages. Other open source tools
solve either one or the other, or target only a particular programming
language.</li>
<li>Anaconda is not only for Python</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-02-working-with-environments"><p>Content from <a href="02-working-with-environments.html">Working with Environments</a></p>
<hr>
<p>Last updated on 2024-11-14 |

        <a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/edit/main/episodes/02-working-with-environments.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 75 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a Conda environment?</li>
<li>How do I create (delete) an environment?</li>
<li>How do I activate (deactivate) an environment?</li>
<li>How do I install packages into existing environments using Conda
(+pip)?</li>
<li>Where should I create my environments?</li>
<li>How do I find out what packages have been installed in an
environment?</li>
<li>How do I find out what environments that exist on my machine?</li>
<li>How do I delete an environment that I no longer need?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how Conda environments can improve your research
workflow.</li>
<li>Create a new environment.</li>
<li>Activate (deactivate) a particular environment.</li>
<li>Install packages into existing environments using Conda (+pip).</li>
<li>Specify the installation location of an environment.</li>
<li>List all of the existing environments on your machine.</li>
<li>List all of the installed packages within a particular
environment.</li>
<li>Delete an entire environment.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="workspace-for-conda-environments" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="workspace-for-conda-environments" class="callout-inner">
<h3 class="callout-title">Workspace for Conda environments</h3>
<div class="callout-content">
<p>If you haven’t done it yet, create a new
<code>introduction-to-conda-for-data-scientists</code> directory on your
Desktop in order to maintain a consistent workspace for all your conda
environment.</p>
<p>On Mac OSX and Linux running following commands in the Terminal will
create the required directory on the Desktop.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> cd ~/Desktop</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">$</span> mkdir introduction-to-conda-for-data-scientists</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">$</span> cd introduction-to-conda-for-data-scientists</span></code></pre>
</div>
<p>For Windows users you may need to reverse the direction of the slash
and run the commands from the command prompt.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">~\Desktop</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="op">&gt;</span> mkdir <span class="ex">introduction-to-conda-for-data-scientists</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="op">&gt;</span> cd <span class="ex">introduction-to-conda-for-data-scientists</span></span></code></pre>
</div>
<p>Alternatively, you can always “right-click” and “create new folder”
on your Desktop. All the commands that are run during the workshop
should be run in a terminal within the
<code>introduction-to-conda-for-data-scientists</code> directory.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-a-conda-environment">What is a Conda environment<a class="anchor" aria-label="anchor" href="#what-is-a-conda-environment"></a>
</h2>
<hr class="half-width">
<p>A <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/environments.html" class="external-link">Conda
environment</a> is a directory that contains a specific collection of
Conda packages that you have installed. For example, you may be working
on a research project that requires NumPy 1.18 and its dependencies,
while another environment associated with an finished project has NumPy
1.12 (perhaps because version 1.12 was the most current version of NumPy
at the time the project finished). If you change one environment, your
other environments are not affected. You can easily activate or
deactivate environments, which is how you switch between them.</p>
<div id="avoid-installing-packages-into-your-base-conda-environment" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="avoid-installing-packages-into-your-base-conda-environment" class="callout-inner">
<h3 class="callout-title">Avoid installing packages into your
<code>base</code> Conda environment</h3>
<div class="callout-content">
<p>Conda has a default environment called <code>base</code> that include
a Python installation and some core system libraries and dependencies of
Conda. It is a “best practice” to avoid installing additional packages
into your <code>base</code> software environment. Additional packages
needed for a new project should always be installed into a newly created
Conda environment.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="creating-environments">Creating environments<a class="anchor" aria-label="anchor" href="#creating-environments"></a>
</h2>
<hr class="half-width">
<p>To create a new environment for Python development using
<code>conda</code> you can use the <code>conda create</code>
command.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">--name</span> python3-env python</span></code></pre>
</div>
<p>For a list of all commands, take a look at <a href="https://docs.conda.io/projects/conda/en/latest/commands.html" class="external-link">Conda
general commands</a>.</p>
<p>It is a good idea to give your environment a meaningful name in order
to help yourself remember the purpose of the environment. While naming
things can be difficult, <code>$PROJECT_NAME-env</code> is a good
convention to follow. Sometimes also the specific version of a package
why you had to create a new environment is a good name</p>
<p>The command above will create a new Conda environment called
“python3” and install the most recent version of Python. If you wish,
you can specify a particular version of packages for <code>conda</code>
to install when creating the environment.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">--name</span> python36-env python=3.6</span></code></pre>
</div>
<div id="always-specify-a-version-number-for-each-package-you-wish-to-install" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="always-specify-a-version-number-for-each-package-you-wish-to-install" class="callout-inner">
<h3 class="callout-title">Always specify a version number for each package you wish to install</h3>
<div class="callout-content">
<p>In order to make your results more reproducible and to make it easier
for research colleagues to recreate your Conda environments on their
machines it is a “best practice” to always explicitly specify the
version number for each package that you install into an environment. If
you are not sure exactly which version of a package you want to use,
then you can use search to see what versions are available using the
<code>conda search</code> command.</p>
<pre><code>$ conda search $PACKAGE_NAME</code></pre>
<p>So, for example, if you wanted to see which versions of <a href="https://scikit-learn.org/stable/" class="external-link">Scikit-learn</a>, a popular
Python library for machine learning, were available, you would run the
following.</p>
<pre><code>$ conda search scikit-learn</code></pre>
<p>As always you can run <code>conda search --help</code> to learn about
available options.</p>
</div>
</div>
</div>
<p>You can create a Conda environment and install multiple packages by
listing the packages that you wish to install.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">--name</span> basic-scipy-env ipython=7.13 matplotlib=3.1 numpy=1.18 scipy=1.4</span></code></pre>
</div>
<p>When <code>conda</code> installs a package into an environment it
also installs any required dependencies. For example, even though Python
is not listed as a packaged to install into the
<code>basic-scipy-env</code> environment above, <code>conda</code> will
still install Python into the environment because it is a required
dependency of at least one of the listed packages.</p>
<div id="creating-a-new-environment" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-a-new-environment" class="callout-inner">
<h3 class="callout-title">Creating a new environment</h3>
<div class="callout-content">
<p>Create a new environment called “machine-learning-env” with Python
and the most current versions of <a href="https://ipython.org/" class="external-link">IPython</a>, <a href="https://matplotlib.org/" class="external-link">Matplotlib</a>, <a href="https://pandas.pydata.org/" class="external-link">Pandas</a>, <a href="https://numba.pydata.org/" class="external-link">Numba</a> and <a href="https://scikit-learn.org/stable/index.html" class="external-link">Scikit-Learn</a>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>In order to create a new environment you use the
<code>conda create</code> command as follows.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">--name</span> machine-learning-env <span class="dt">\</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a> ipython <span class="dt">\</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a> matplotlib <span class="dt">\</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a> pandas <span class="dt">\</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a> python <span class="dt">\</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a> scikit-learn <span class="dt">\</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a> numba</span></code></pre>
</div>
<p>Since no version numbers are provided for any of the Python packages,
Conda will download the most current, mutually compatible versions of
the requested packages. However, since it is best practice to always
provide explicit version numbers, you should prefer the following
solution.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">--name</span> machine-learning-env <span class="dt">\</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a> ipython=7.19 <span class="dt">\</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a> matplotlib=3.3 <span class="dt">\</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a> pandas=1.2 <span class="dt">\</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a> python=3.8 <span class="dt">\</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a> scikit-learn=0.23 <span class="dt">\</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a> numba=0.51</span></code></pre>
</div>
<p>However, please be aware that the version numbers for each packages
may not be the latest available and would need to be adjusted.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="activating-an-existing-environment">Activating an existing environment<a class="anchor" aria-label="anchor" href="#activating-an-existing-environment"></a>
</h2>
<hr class="half-width">
<p>Activating environments is essential to making the software in
environments work well (or sometimes at all!). Activation of an
environment does two things.</p>
<ol style="list-style-type: decimal">
<li>Adds entries to <code>PATH</code> for the environment.</li>
<li>Runs any activation scripts that the environment may contain.</li>
</ol>
<p>Step 2 is particularly important as activation scripts are how
packages can set arbitrary environment variables that may be necessary
for their operation. Aou activate the <code>basic-scipy-env</code>
environment by name using the <code>activate</code> command.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> conda activate basic-scipy-env</span></code></pre>
</div>
<p>You can see that an environment has been activated because the shell
prompt will now include the name of the active environment.</p>
<pre><code>(basic-scipy-env) $</code></pre>
</section><section><h2 class="section-heading" id="deactivate-the-current-environment">Deactivate the current environment<a class="anchor" aria-label="anchor" href="#deactivate-the-current-environment"></a>
</h2>
<hr class="half-width">
<p>To deactivate the currently active environment use the Conda
<code>deactivate</code> command as follows.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">basic-scipy-env</span><span class="kw">)</span> <span class="ex">$</span> conda deactivate</span></code></pre>
</div>
<p>You can see that an environment has been deactivated because the
shell prompt will no longer include the name of the previously active
environment.</p>
<pre><code>$</code></pre>
<div id="returning-to-the-base-environment" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="returning-to-the-base-environment" class="callout-inner">
<h3 class="callout-title">Returning to the <code>base</code>
environment</h3>
<div class="callout-content">
<p>To return to the <code>base</code> Conda environment, it’s better to
call <code>conda activate</code> with no environment specified, rather
than to use <code>deactivate</code>. If you run
<code>conda deactivate</code> from your <code>base</code> environment,
you may lose the ability to run <code>conda</code> commands at all.
<strong>Don’t worry if you encounter this undesirable state! Just start
a new shell.</strong></p>
</div>
</div>
</div>
<div id="activate-an-existing-environment-by-name" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="activate-an-existing-environment-by-name" class="callout-inner">
<h3 class="callout-title">Activate an existing environment by name</h3>
<div class="callout-content">
<p>Activate the <code>machine-learning-env</code> environment created in
the previous challenge by name.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>In order to activate an existing environment by name you use the
<code>conda activate</code> command as follows.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> conda activate machine-learning-env</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="deactivate-the-active-environment" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="deactivate-the-active-environment" class="callout-inner">
<h3 class="callout-title">Deactivate the active environment</h3>
<div class="callout-content">
<p>Deactivate the <code>machine-learning-env</code> environment that you
activated in the previous challenge.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>In order to deactivate the active environment you use the
<code>conda deactivate</code> command.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="kw">(</span><span class="ex">active-environment-name</span><span class="kw">)</span> <span class="ex">$</span> conda deactivate</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="installing-a-package-into-an-existing-environment">Installing a package into an existing environment<a class="anchor" aria-label="anchor" href="#installing-a-package-into-an-existing-environment"></a>
</h2>
<hr class="half-width">
<p>You can install a package into an existing environment using the
<code>conda install</code> command. This command accepts a list of
package specifications (i.e., <code>numpy=1.18</code>) and installs a
set of packages consistent with those specifications <em>and</em>
compatible with the underlying environment. If full compatibility cannot
be assured, an error is reported and the environment is <em>not</em>
changed.</p>
<p>By default the <code>conda install</code> command will install
packages into the current, active environment. The following would
activate the <code>basic-scipy-env</code> we created above and install
<a href="https://numba.pydata.org/" class="external-link">Numba</a>, an open source JIT
compiler that translates a subset of Python and NumPy code into fast
machine code, into the active environment.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">$</span> conda activate basic-scipy-env</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="ex">$</span> conda install numba</span></code></pre>
</div>
<p>As was the case when listing packages to install when using the
<code>conda create</code> command, if version numbers are not explicitly
provided, Conda will attempt to install the newest versions of any
requested packages. To accomplish this, Conda may need to update some
packages that are already installed or install additional packages. It
is always a good idea to explicitly provide version numbers when
installing packages with the <code>conda install</code> command. For
example, the following would install a particular version of
Scikit-Learn, into the current, active environment.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> conda install scikit-learn=0.22</span></code></pre>
</div>
<div id="freezing-installed-packages" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="freezing-installed-packages" class="callout-inner">
<h3 class="callout-title">Freezing installed packages</h3>
<div class="callout-content">
<p>To prevent existing packages from being updating when using the
<code>conda install</code> command, you can use the
<code>--freeze-installed</code> option. This may force Conda to install
older versions of the requested packages in order to maintain
compatibility with previously installed packages. Using the
<code>--freeze-installed</code> option does not prevent additional
dependency packages from being installed.</p>
</div>
</div>
</div>
<div id="installing-a-package-into-a-specific-environment" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="installing-a-package-into-a-specific-environment" class="callout-inner">
<h3 class="callout-title">Installing a package into a specific environment</h3>
<div class="callout-content">
<p><a href="https://dask.org/" class="external-link">Dask</a> provides advanced parallelism
for data science workflows enabling performance at scale for the core
Python data science tools such as Numpy Pandas, and Scikit-Learn. Have a
read through the <a href="https://docs.conda.io/projects/conda/en/latest/commands/install.html" class="external-link">official
documentation</a> for the <code>conda install</code> command and see if
you can figure out how to install Dask into the
<code>machine-learning-env</code> that you created in the previous
challenge.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>You can install Dask into <code>machine-learning-env</code> using the
<code>conda install</code> command as follow.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">$</span> conda install <span class="at">--name</span> machine-learning-env dask=2.16</span></code></pre>
</div>
<p>You could also install Dask into <code>machine-learning-env</code> by
first activating that environment and then using the
<code>conda install</code> command.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">$</span> conda activate machine-learning-env</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="ex">$</span> conda install dask=2020.12</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="where-do-conda-environments-live">Where do Conda environments live?<a class="anchor" aria-label="anchor" href="#where-do-conda-environments-live"></a>
</h2>
<hr class="half-width">
<p>Environments created with <code>conda</code>, by default, live in the
<code>envs/</code> folder of your <code>miniconda3</code> (or
<code>anaconda3</code>) directory the absolute path to which will look
something the following: <code>/Users/$USERNAME/miniconda3/envs</code>
or <code>C:\Users\$USERNAME\Anaconda3</code>.</p>
<p>Running <code>ls</code> (linux) / <code>dir</code> (Windows) on your
anaconda <code>envs/</code> directory will list out the directories
containing the existing Conda environments.</p>
<div id="location-of-conda-environments-on-binder" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="location-of-conda-environments-on-binder" class="callout-inner">
<h3 class="callout-title">Location of Conda environments on Binder</h3>
<div class="callout-content">
<p>If you are working through these lessons using a Binder instance,
then the default location of the Conda environments is slightly
different.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> /srv/conda/envs</span></code></pre>
</div>
<p>Running <code>ls /srv/conda/envs/</code> from a terminal will list
out the directories containing any previously installed Conda
environments.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="how-do-i-specify-a-location-for-a-conda-environment">How do I specify a location for a Conda environment?<a class="anchor" aria-label="anchor" href="#how-do-i-specify-a-location-for-a-conda-environment"></a>
</h2>
<hr class="half-width">
<p>You can control where a Conda environment lives by providing a path
to a target directory when creating the environment. For example to
following command will create a new environment in a sub-directory of
the current working directory called <code>env</code>.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">$</span> conda create <span class="at">--prefix</span> ./env ipython=7.13 matplotlib=3.1 pandas=1.0 python=3.6</span></code></pre>
</div>
<p>You activate an environment created with a prefix using the same
command used to activate environments created by name.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">$</span> conda activate ./env</span></code></pre>
</div>
<p>It is often a good idea to specify a path to a sub-directory of your
project directory when creating an environment. Why?</p>
<ol style="list-style-type: decimal">
<li>Makes it easy to tell if your project utilizes an isolated
environment by including the environment as a sub-directory.</li>
<li>Makes your project more self-contained as everything <em>including
the required software</em> is contained in a single project
directory.</li>
</ol>
<p>An additional benefit of creating your project’s environment inside a
sub-directory is that you can then use the same name for all your
environments; if you keep all of your environments in your
<code>~/miniconda3/env/</code> folder, you’ll have to give each of them
a different name.</p>
<div id="conda-environment-sub-directory-naming-convention" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="conda-environment-sub-directory-naming-convention" class="callout-inner">
<h3 class="callout-title">Conda environment sub-directory naming convention</h3>
<div class="callout-content">
<p>In order to be consistent with the convention used by tools such as
<code>venv</code> and <code>Pipenv</code>, I recommend using
<code>env</code> as the name of the sub-directory of your project
directory that contains your Conda environment. A benefit of maintaining
the convention is that your environment sub-directory will be
automatically ignored by the default Python <code>.gitignore</code> file
used on <a href="https://github.com/github/gitignore/blob/master/Python.gitignore" class="external-link">GitHub</a>.</p>
<p>Whatever naming convention you adopt it is important to be
consistent! Using the same name for all of your Conda environments
allows you to use the same <code>activate</code> command as well.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">$</span> cd my-project/</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="ex">$</span> conda activate ./env</span></code></pre>
</div>
</div>
</div>
</div>
<div id="creating-a-new-environment-as-a-sub-directory-within-a-project-directory" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-a-new-environment-as-a-sub-directory-within-a-project-directory" class="callout-inner">
<h3 class="callout-title">Creating a new environment as a sub-directory within a project directory</h3>
<div class="callout-content">
<p>First create a project directory called <code>project-dir</code>
using the following command.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">$</span> mkdir project-dir</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="ex">$</span> cd project-dir</span></code></pre>
</div>
<p>Next, create a new environment inside the newly created
<code>project-dir</code> in a sub-directory called <code>env</code> an
install Python 3.6, version 3.1 of Matplotlib, and version 2.0 of <a href="https://www.tensorflow.org/" class="external-link">TensorFlow</a>.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">project-dir</span> $ conda create <span class="at">--prefix</span> ./env <span class="dt">\</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>python=3.6 <span class="dt">\</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>matplotlib=3.1 <span class="dt">\</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>tensorflow=2.0 <span class="dt">\</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Placing Conda environments outside of the default
<code>~/miniconda3/envs/</code> folder comes with a couple of minor
drawbacks. First, <code>conda</code> can no longer find your environment
with the <code>--name</code> flag; you’ll generally need to pass the
<code>--prefix</code> flag along with the environment’s full path to
find the environment.</p>
<p>Second, an annoying side-effect of specifying an install path when
creating your Conda environments is that your command prompt is now
prefixed with the active environment’s absolute path rather than the
environment’s name. After activating an environment using its prefix
your prompt will look similar to the following.</p>
<pre><code>(/absolute/path/to/env) $</code></pre>
<p>As you can imagine, this can quickly get out of hand.</p>
<pre><code>(/Users/USER_NAME/research/data-science/PROJECT_NAME/env) $</code></pre>
<p>If (like me!) you find this long prefix to your shell prompt
annoying, then there is a quick fix: modify the <code>env_prompt</code>
setting in your <code>.condarc</code> file, which you can do with the
following command.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">$</span> conda config <span class="at">--set</span> env_prompt <span class="st">'({name})'</span></span></code></pre>
</div>
<p>This will either edit your <code>~/.condarc</code> file if you
already have one or create a <code>~/.condarc</code> file if you do not.
Now your command prompt will display the active environment’s generic
name.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">$</span> cd project-directory</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="ex">$</span> conda activate ./env</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="kw">(</span><span class="fu">env</span><span class="kw">)</span> <span class="ex">project-directory</span> $</span></code></pre>
</div>
<p>For more on modifying your <code>.condarc</code> file, see the <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/configuration/use-condarc.html" class="external-link">official
Conda docs</a>.</p>
<div id="activate-an-existing-environment-by-path" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="activate-an-existing-environment-by-path" class="callout-inner">
<h3 class="callout-title">Activate an existing environment by path</h3>
<div class="callout-content">
<p>Activate the environment created in a previous challenge using the
path to the environment directory.</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>You can activate an existing environment by providing the path the
the environment directory instead of the environment name when using the
<code>conda activate</code> command as follows.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">$</span> conda activate ./env</span></code></pre>
</div>
<p>Note that the provided path can either be absolute or relative. If
the path is a relative path then it must start with <code>./</code> on
Unix systems and <code>.\</code> when using PowerShell on Windows.</p>
</div>
</div>
</div>
</div>
<div id="conda-can-create-environments-for-r-projects-too" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="conda-can-create-environments-for-r-projects-too" class="callout-inner">
<h3 class="callout-title">Conda can create environments for R projects too!</h3>
<div class="callout-content">
<p>First create a project directory called <code>r-project-dir</code>
using the following command.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">$</span> cd ~/Desktop/introduction-to-conda-for-data-scientists</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="ex">$</span> mkdir r-project-dir</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="ex">$</span> cd r-project-dir</span></code></pre>
</div>
<p>Next, take a look through the <a href="https://anaconda.org/r/repo" class="external-link">list of R packages</a> available by
default for installation using <code>conda</code>. Create a new
environment inside the newly created <code>r-project-dir</code> in a
sub-directory called <code>env</code> and install <code>r-base</code>,
<code>r-tidyverse</code> and <code>r-sparklyr</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Show me the solution </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">project-dir</span> $ conda create <span class="at">--prefix</span> ./env <span class="dt">\</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="op">&gt;</span> r-base <span class="dt">\</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="op">&gt;</span> r-tidyverse <span class="dt">\</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="op">&gt;</span> r-sparklyr <span class="dt">\</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="listing-existing-environments">Listing existing environments<a class="anchor" aria-label="anchor" href="#listing-existing-environments"></a>
</h2>
<hr class="half-width">
<p>Now that you have created a number of Conda environments on your
local machine you have probably forgotten the names of all of the
environments and exactly where they live. Fortunately, there is a
<code>conda</code> command to list all of your existing environments
together with their locations.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">$</span> conda env list</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="listing-the-contents-of-an-environment">Listing the contents of an environment<a class="anchor" aria-label="anchor" href="#listing-the-contents-of-an-environment"></a>
</h2>
<hr class="half-width">
<p>In addition to forgetting names and locations of Conda environments,
at some point you will probably forget exactly what has been installed
in a particular Conda environment. Again, there is a <code>conda</code>
command for listing the contents on an environment. To list the contents
of the <code>basic-scipy-env</code> that you created above, run the
following command.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="ex">$</span> conda list <span class="at">--name</span> basic-scipy-env</span></code></pre>
</div>
<p>If you created your Conda environment using the <code>--prefix</code>
option to install packages into a particular directory, then you will
need to use that prefix in order for <code>conda</code> to locate the
environment on your machine.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="ex">$</span> conda list <span class="at">--prefix</span> /path/to/conda-env</span></code></pre>
</div>
<div id="listing-the-contents-of-a-particular-environment." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="listing-the-contents-of-a-particular-environment." class="callout-inner">
<h3 class="callout-title">Listing the contents of a particular environment.</h3>
<div class="callout-content">
<p>List the packages installed in the <code>machine-learning-env</code>
environment that you created in a previous challenge.</p>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8"> Show me the solution </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" aria-labelledby="headingSolution8" data-bs-parent="#accordionSolution8">
<div class="accordion-body">
<p>You can list the packages and their versions installed in
<code>machine-learning-env</code> using the <code>conda list</code>
command as follows.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="ex">$</span> conda list <span class="at">--name</span> machine-learning-env</span></code></pre>
</div>
<p>To list the packages and their versions installed in the active
environment leave off the <code>--name</code> or <code>--prefix</code>
option.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">$</span> conda list</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="deleting-entire-environments">Deleting entire environments<a class="anchor" aria-label="anchor" href="#deleting-entire-environments"></a>
</h2>
<hr class="half-width">
<p>Occasionally, you will want to delete an entire environment. Perhaps
you were experimenting with <code>conda</code> commands and you created
an environment you have no intention of using; perhaps you no longer
need an existing environment and just want to get rid of cruft on your
machine. Whatever the reason, the command to delete an environment is
the following.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="ex">$</span> conda remove <span class="at">--name</span> my-first-conda-env <span class="at">--all</span></span></code></pre>
</div>
<p>If you wish to delete and environment that you created with a
<code>--prefix</code> option, then you will need to provide the prefix
again when removing the environment.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="ex">$</span> conda remove <span class="at">--prefix</span> /path/to/conda-env/ <span class="at">--all</span></span></code></pre>
</div>
<div id="delete-an-entire-environment" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="delete-an-entire-environment" class="callout-inner">
<h3 class="callout-title">Delete an entire environment</h3>
<div class="callout-content">
<p>Delete the entire “basic-scipy-env” environment.</p>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9"> Show me the solution </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" aria-labelledby="headingSolution9" data-bs-parent="#accordionSolution9">
<div class="accordion-body">
<p>In order to delete an entire environment you use the
<code>conda remove</code> command as follows.</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="ex">$</span> conda remove <span class="at">--name</span> basic-scipy-env <span class="at">--all</span> <span class="at">--yes</span></span></code></pre>
</div>
<p>This command will remove all packages from the named environment
before removing the environment itself. The use of the
<code>--yes</code> flag short-circuits the confirmation prompt (and
should be used with caution).</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>A Conda environment is a directory that contains a specific
collection of Conda packages that you have installed.</li>
<li>You create (remove) a new environment using the
<code>conda create</code> (<code>conda remove</code>) commands.</li>
<li>You activate (deactivate) an environment using the
<code>conda activate</code> (<code>conda deactivate</code>)
commands.</li>
<li>You install packages into environments using
<code>conda install</code>; you install packages into an active
environment using <code>pip install</code>.</li>
<li>You should install each environment as a sub-directory inside its
corresponding project directory</li>
<li>Use the <code>conda env list</code> command to list existing
environments and their respective locations.</li>
<li>Use the <code>conda list</code> command to list all of the packages
installed in an environment.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-03-using-packages-and-channels"><p>Content from <a href="03-using-packages-and-channels.html">Using Packages and Channels</a></p>
<hr>
<p>Last updated on 2024-11-14 |

        <a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/edit/main/episodes/03-using-packages-and-channels.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="objectives:">
<ul>
<li>Install a package from a specific channel.</li>
</ul>
</div>
<section><h2 class="section-heading" id="what-are-conda-packages">What are Conda packages?<a class="anchor" aria-label="anchor" href="#what-are-conda-packages"></a>
</h2>
<hr class="half-width">
<p>A conda package is a compressed archive file (<code>.tar.bz2</code>)
that contains:</p>
<ul>
<li>system-level libraries</li>
<li>Python or other modules</li>
<li>executable programs and other components</li>
<li>metadata under the <code>info/</code> directory</li>
<li>a collection of files that are installed directly into an
<code>install</code> prefix.</li>
</ul>
<p>Conda keeps track of the dependencies between packages and platforms;
the conda package format is identical across platforms and operating
systems.</p>
<div class="section level3">
<h3 id="package-structure">Package Structure<a class="anchor" aria-label="anchor" href="#package-structure"></a>
</h3>
<p>All conda packages have a specific sub-directory structure inside the
tarball file. There is a <code>bin</code> directory that contains any
binaries for the package; a <code>lib</code> directory containing the
relevant library files (i.e., the <code>.py</code> files); and an
<code>info</code> directory containing package metadata. For a more
details of the conda package specification, including discussions of the
various metadata files, see the [docs][conda-pkg-spec-docs].</p>
<p>As an example of Conda package structure consider the <a href="https://pytorch.org/" class="external-link">Conda</a> package for Python 3.6 version of
PyTorch targeting a 64-bit Mac OS,
<code>pytorch-1.1.0-py3.6_0.tar.bz2</code>.</p>
<pre class="text"><code>├── bin
│   └── convert-caffe2-to-onnx
│   └── convert-onnx-to-caffe2
├── info
│   ├── LICENSE.txt
│   ├── about.json
│   ├── files
│   ├── git
│   ├── has_prefix.json
│   ├── hash_input.json
│   ├── index.json
│   ├── paths.json
│   ├── recipe/
│   └── test/
└── lib
    └── python3.6
        └── site-packages
            ├── caffe2/
            ├── torch/
            └── torch-1.1.0-py3.6.egg-info/</code></pre>
<p>A complete listing of available PyTorch packages can be found on <a href="https://anaconda.org/pytorch/pytorch/files" class="external-link">Anaconda
Cloud</a>.</p>
</div>
</section><section><h2 class="section-heading" id="what-are-conda-channels">What are Conda channels?<a class="anchor" aria-label="anchor" href="#what-are-conda-channels"></a>
</h2>
<hr class="half-width">
<p>Again from the <a href="https://conda.io/en/latest/" class="external-link">Conda
documentation</a>, conda packages are downloaded from remote channels,
which are URLs to directories containing conda packages. The
<code>conda</code> command searches a default set of channels, and
packages are automatically downloaded and updated from the <a href="https://repo.anaconda.com/pkgs/" class="external-link">Anaconda Cloud channels</a>.</p>
<ul>
<li>
<code>main</code>: The majority of all new Anaconda, Inc. package
builds are hosted here. Included in conda’s defaults channel as the top
priority channel.</li>
<li>
<code>r</code>: Microsoft R Open conda packages and <a href="https://anaconda.org/r/repo" class="external-link">Anaconda, Inc.’s R conda
packages</a>. This channel is included in conda’s defaults channel. When
creating new environments, MRO is now chosen as the default R
implementation.</li>
</ul>
<p>Collectively, the Anaconda managed channels are referred to as the
<code>defaults</code> channel because, unless otherwise specified,
packages installed using <code>conda</code> will be downloaded from
these channels.</p>
<blockquote>
<h2 id="the-conda-forge-channel">The <code>conda-forge</code>
channel</h2>
<p>In addition to the <code>default</code> channels that are managed by
Anaconda Inc., there is another channel called that also has a special
status. The <a href="https://github.com/conda-forge" class="external-link">Conda-Forge</a>
project “is a community led collection of recipes, build infrastructure
and distributions for the conda package manager.”</p>
<p>There are a few reasons that you may wish to use the
<code>conda-forge</code> channel instead of the <code>defaults</code>
channel maintained by Anaconda:</p>
<ol style="list-style-type: decimal">
<li>Packages on <code>conda-forge</code> may be more up-to-date than
those on the <code>defaults</code> channel.</li>
<li>There are packages on the <code>conda-forge</code> channel that
aren’t available from <code>defaults</code>.</li>
<li>You may wish to use a dependency such as <code>openblas</code> (from
<code>conda-forge</code>) instead of <code>mkl</code> (from
<code>defaults</code>). {: .callout}</li>
</ol>
</blockquote>
</section><section><h2 class="section-heading" id="how-do-i-install-a-package-from-a-specific-channel">How do I install a package from a specific channel?<a class="anchor" aria-label="anchor" href="#how-do-i-install-a-package-from-a-specific-channel"></a>
</h2>
<hr class="half-width">
<p>You can install a package from a specific channel into the currently
activate environment by passing the <code>--channel</code> option to the
<code>conda install</code> command as follows.</p>
<pre><code>$ conda activate machine-learning-env
$ conda install scipy=1.6 --channel conda-forge</code></pre>
<p>{: .language-bash}</p>
<p>You can also install a package from a specific channel into a named
environment (using <code>--name</code>) or into an environment installed
at a particular prefix (using <code>--prefix</code>). For example, the
following command installs the <code>scipy</code> package from the
<code>conda-forge</code> channel into the environment called
<code>my-first-conda-env</code> which we created earlier.</p>
<pre><code>$ conda install scipy=1.6 --channel conda-forge --name machine-learning-env</code></pre>
<p>{: .language-bash}</p>
<p>This command would install <code>tensorflow</code> package from
<code>conda-forge</code> channel into an environment installed into the
<code>env/</code> sub-directory.</p>
<pre><code>$ conda install tensorflow=1.14 --channel conda-forge --prefix ./env</code></pre>
<p>{: .language-bash}</p>
<p>Here is another example for R users. The following command would
install <a href="https://anaconda.org/r/r-tidyverse" class="external-link"><code>r-tidyverse</code></a>
package from the <code>conda-forge</code> channel into an environment
installed into the <code>env/</code> sub-directory.</p>
<pre><code>$ cd ~/Desktop/introduction-to-conda-for-data-scientists
$ conda install r-tidyverse=1.3 --channel conda-forge --prefix ./env</code></pre>
<p>{: .language-bash}</p>
<blockquote>
<h2 id="channel-priority">Channel priority</h2>
<p>You may specify multiple channels for installing packages by passing
the <code>--channel</code> argument multiple times.</p>
<pre><code>$ conda install scipy=1.6 --channel conda-forge --channel bioconda</code></pre>
<p>{: .language-bash}</p>
<p>Channel priority decreases from left to right - the first argument
has higher priority than the second. For reference, bioconda is a
channel for the conda package manager specializing in bioinformatics
software. For those interested in learning more about the Bioconda
project, checkout the project’s <a href="https://bioconda.github.io/" class="external-link">GitHub</a> page.</p>
<p>Please note that in our example, adding <code>bioconda</code> channel
is irrelevant because <code>scipy</code> is no longer available on
<code>bioconda</code> channel. {: .callout}</p>
</blockquote>
</section><section><h2 class="section-heading" id="my-package-isnt-available-on-the-defaults-channel-what-should-i-do">My package isn’t available on the <code>defaults</code> channel!
What should I do?<a class="anchor" aria-label="anchor" href="#my-package-isnt-available-on-the-defaults-channel-what-should-i-do"></a>
</h2>
<hr class="half-width">
<p>It may very well be the case that packages (or often more recent
versions of packages!) that you need to install for your project are not
available on the <code>defaults</code> channel. In this case you should
try the following.</p>
<ol style="list-style-type: decimal">
<li>
<code>conda-forge</code>: the <code>conda-forge</code> channel
contains a large number of community curated conda packages. Typically
the most recent versions of packages that are generally available via
the <code>defaults</code> channel are available on
<code>conda-forge</code> first.</li>
<li>
<code>bioconda</code>: the <code>bioconda</code> channel also
contains a large number of Bioinformatics curated conda packages.
<code>bioconda</code> channel is meant to be used with
<code>conda-forge</code>, you should not worried about using the two
channels when installing your prefered packages.</li>
<li>
<code>pip</code>: only if a package is not otherwise available via
<code>conda-forge</code> (or some domain-specific channel like
<code>bioconda</code>) should a package be installed into a conda
environment from PyPI using <code>pip</code>.</li>
</ol>
<p>For example, <a href="https://www.kaggle.com/" class="external-link">Kaggle</a> publishes a
Python 3 API that can be used to interact with Kaggle datasets, kernels
and competition submissions. You can search for the package on the
<code>defaults</code> channels but you will not find it!</p>
<pre><code>$ conda search kaggle
Loading channels: done
No match found for: kaggle. Search: *kaggle*

PackagesNotFoundError: The following packages are not available from current channels:

  - kaggle

Current channels:

  - https://repo.anaconda.com/pkgs/main/osx-64
  - https://repo.anaconda.com/pkgs/main/noarch
  - https://repo.anaconda.com/pkgs/free/osx-64
  - https://repo.anaconda.com/pkgs/free/noarch
  - https://repo.anaconda.com/pkgs/r/osx-64
  - https://repo.anaconda.com/pkgs/r/noarch

To search for alternate channels that may provide the conda package you're
looking for, navigate to

    https://anaconda.org

and use the search bar at the top of the page.</code></pre>
<p>{: .language-bash}</p>
<p>The <a href="https://github.com/Kaggle/kaggle-api" class="external-link">official
installation instructions</a> suggest downloading the
<code>kaggle</code> package using <code>pip</code>. But since we are
using <code>conda</code> we should check whether the package exists on
at least <code>conda-forge</code> channel before proceeding to use
<code>pip</code>.</p>
<pre><code>$ conda search --channel conda-forge kaggle
Loading channels: done
# Name                       Version           Build  Channel
kaggle                         1.5.3          py27_1  conda-forge
kaggle                         1.5.3          py36_1  conda-forge
kaggle                         1.5.3          py37_1  conda-forge
kaggle                         1.5.4          py27_0  conda-forge
kaggle                         1.5.4          py36_0  conda-forge
kaggle                         1.5.4          py37_0  conda-forge
.
.
.</code></pre>
<p>{: .language-bash}</p>
<p>Or you can also check online at <a href="https://anaconda.org/conda-forge/kaggle" class="external-link">https://anaconda.org/conda-forge/kaggle</a>.</p>
<p>Once we know that the <code>kaggle</code> package is available via
<code>conda-forge</code> we can go ahead and install it.</p>
<pre><code>$ conda install --channel conda-forge kaggle=1.5.10  --prefix ./env</code></pre>
<p>{: .language-bash}</p>
</section><section><h2 class="section-heading" id="what-actually-happens-when-i-install-packages">What actually happens when I install packages?<a class="anchor" aria-label="anchor" href="#what-actually-happens-when-i-install-packages"></a>
</h2>
<hr class="half-width">
<p>During the installation process, files are extracted into the
specified environment (defaulting to the current environment if none is
specified). Installing the files of a conda package into an environment
can be thought of as changing the directory to an environment, and then
downloading and extracting the package and its dependencies.</p>
<p>For example, when you <code>conda install</code> a package that
exists in a channel and has no dependencies, conda does the
following.</p>
<ol style="list-style-type: decimal">
<li>looks at your configured channels (in priority)</li>
<li>reaches out to the repodata associated with your
channels/platform</li>
<li>parses repodata to search for the package</li>
<li>once the package is found, conda pulls it down and installs</li>
</ol>
<p>The [conda documentation][conda-install-docs] has a nice decision
tree that describes the package installation process.</p>
<p align="center">
<img alt="Installing with Conda" src="../../fig/installing-with-conda.png" width="250" class="figure"></p>
<blockquote>
<h2 id="specifying-channels-when-installing-packages">Specifying
channels when installing packages</h2>
<p>Like many projects, <a href="https://pytorch.org/" class="external-link">PyTorch</a> has
its own <a href="https://anaconda.org/pytorch" class="external-link">channel</a> on Anaconda
Cloud. This channel has several interesting packages, in particular
<code>pytorch</code> (PyTorch core) and <code>torchvision</code>
(datasets, transforms, and models specific to computer vision).</p>
<p>Create a new directory called <code>my-computer-vision-project</code>
and then create a Python 3.6 environment in a sub-directory called
<code>env/</code> with the two packages listed above. Also include the
most recent version of <code>jupyterlab</code> in your environment (so
you have a nice UI) and <code>matplotlib</code> (so you can make
plots).</p>
<blockquote>
<h2 id="solution">Solution</h2>
<p>In order to create a new environment you use the
<code>conda create</code> command as follows.</p>
<pre><code>$ mkdir my-computer-vision-project
$ cd my-computer-vision-project/
$ conda create --prefix ./env --channel pytorch \
 python=3.6 \
 jupyterlab=1.0 \
 pytorch=1.1 \
 torchvision=0.3 \
 matplotlib=3.1</code></pre>
<p>{: .language-bash}</p>
<p>Hint: For the lazy typers: the <code>--channel</code> argument can
also be shortened to <code>-c</code>, for more abbreviations, see also
the <a href="https://docs.conda.io/projects/conda/en/latest/commands.html" class="external-link">Conda
command reference</a> . {: .solution} {: .challenge}</p>
</blockquote>
</blockquote>
<blockquote>
<h2 id="alternative-syntax-for-installing-packages-from-specific-channels">Alternative
syntax for installing packages from specific channels</h2>
<p>There exists an alternative syntax for installing conda packages from
specific channels that more explicitly links the channel being used to
install a particular package.</p>
<pre><code>$ conda install conda-forge::tensorflow  --prefix ./env</code></pre>
<p>{: .language-bash}</p>
<p>Create a new folder <code>my-final-project</code> in
<code>~/Desktop/introduction-to-conda-for-data-scientists</code> and
repeat the previous exercise using this alternative syntax to install
<code>python</code>, <code>jupyterlab</code>, and
<code>matplotlib</code> from the <code>conda-forge</code> channel and
<code>pytorch</code> and <code>torchvision</code> from the
<code>pytorch</code> channel.</p>
<blockquote>
<h2 id="solution-1">Solution</h2>
<p>One possibility would be to use the <code>conda create</code> command
as follows.</p>
<pre><code>$ cd ~/Desktop/introduction-to-conda-for-data-scientists
$ mkdir my-final-project
$ cd my-final-project/
$ conda create --prefix ./env \
 conda-forge::python=3.6 \
 conda-forge::jupyterlab=1.0 \
 conda-forge::matplotlib=3.1 \
 pytorch::pytorch=1.1 \
 pytorch::torchvision=0.3</code></pre>
<p>{: .language-bash} {: .solution} {: .challenge}</p>
</blockquote>
</blockquote>
</section><section><h2 class="section-heading" id="a-python-package-isnt-available-on-any-conda-channel-what-should-i-do">A Python package isn’t available on any Conda channel! What should I
do?<a class="anchor" aria-label="anchor" href="#a-python-package-isnt-available-on-any-conda-channel-what-should-i-do"></a>
</h2>
<hr class="half-width">
<p>If a Python package that you need isn’t available on any Conda
channel, then you can use the default Python package manager <a href="https://pip.pypa.io/en/stable/" class="external-link">Pip</a> to install this package
from <a href="https://pypi.org/" class="external-link">PyPI</a>. However, there are a few <a href="https://www.anaconda.com/blog/using-pip-in-a-conda-environment" class="external-link">potential
issues</a> that you should be aware of when using Pip to install Python
packages when using Conda.</p>
<p>First, Pip is sometimes installed by default on operating systems
where it is used to manage any Python packages needed by your OS.
<strong>You do not want to use this <code>pip</code> to install Python
packages when using Conda environments.</strong></p>
<pre><code>(base) $ conda deactivate
$ which python
/usr/bin/python
$ which pip # sometimes installed as pip3
/usr/bin/pip</code></pre>
<p>{: .language-bash}</p>
<p>Second, Pip is also included in the Miniconda installer where it is
used to install and manage OS specific Python packages required to setup
your base Conda environment. <strong>You do not want to use this
<code>pip</code> to install Python packages when using Conda
environments.</strong></p>
<pre><code>$ conda activate
(base) $ which python
~/miniconda3/bin/python
$ which pip
~/miniconda3/bin/pip</code></pre>
<p>{: .language-bash}</p>
<blockquote>
<h2 id="another-reaon-to-avoid-installing-packages-into-your-base-conda-environment">Another
reaon to avoid installing packages into your <code>base</code> Conda
environment</h2>
<p>If your <code>base</code> Conda environment becomes cluttered with a
mix of Pip and Conda installed packages it may no longer function.
Creating separate conda environments allows you to delete and recreate
environments readily so you dont have to worry about risking your core
Conda functionality when mixing packages installed with Conda and Pip.
{: .callout}</p>
</blockquote>
<p>If you find yourself needing to install a Python package that is only
available via Pip, then you should first install <code>pip</code> into
your Conda environment and then use that <code>pip</code> to install the
desired package. Using the <code>pip</code> installed in your Conda
environment to install Python packages not available via Conda channels
will help you avoid difficult to debug issues that frequently arise when
using Python packages installed via a <code>pip</code> that was not
installed inside you Conda environment.</p>
<blockquote>
<h2 id="conda-pip-conda-wherever-possible-pip-only-when-necessary">Conda
(+Pip): Conda wherever possible; Pip only when necessary</h2>
<p>When using Conda to manage environments for your Python project it is
a good idea to install packages available via both Conda and Pip using
Conda; however there will always be cases where a package is only
available via Pip in which case you will need to use Pip. Many of the
common pitfalls of using Conda and Pip together can be avoided by
adopting the following practices.</p>
<ul>
<li>Always explicitly install <code>pip</code> in <em>every</em>
Python-based Conda environment.</li>
<li>Always be sure your desired environment is <em>active</em> before
installing anything using <code>pip</code>.</li>
<li>Prefer <code>python -m pip install</code> over
<code>pip install</code>; never use <code>pip</code> with the
<code>--user</code> argument. {: .callout}</li>
</ul>
</blockquote>
<blockquote>
<h2 id="installing-packages-into-conda-environments-using-pip">Installing
packages into Conda environments using <code>pip</code>
</h2>
<p><a href="https://github.com/yzhao062/combo" class="external-link">Combo</a> is a
comprehensive Python toolbox for combining machine learning models and
scores. Model combination can be considered as a subtask of <a href="https://en.wikipedia.org/wiki/Ensemble_learning" class="external-link">ensemble
learning</a>, and has been widely used in real-world tasks and data
science competitions like <a href="https://www.kaggle.com/" class="external-link">Kaggle</a>.</p>
<p>Activate the <code>machine-learning-env</code> you created in a
previous challenge and use <code>pip</code> to install
<code>combo</code>.</p>
<blockquote>
<h2 id="solution-2">Solution</h2>
<p>The following commands will activate the <code>basic-scipy-env</code>
and install <code>combo</code>.</p>
<pre><code>$ conda install --name machine-learning-env pip
$ conda activate machine-learning-env
$ python -m pip install combo==0.1.*</code></pre>
<p>{: .language-bash}</p>
<p>For more details on using <code>pip</code> see the <a href="https://pip.pypa.io/en/stable/" class="external-link">official documentation</a>. {:
.solution} {: .challenge}</p>
</blockquote>
</blockquote>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>A package is a tarball containing system-level libraries, Python or
other modules, executable programs and other components, and associated
metadata.</li>
<li>A Conda channel is a URL to a directory containing a Conda
package(s).</li>
<li>Explicitly including the channels (and their priority!) in a
project’s environment file is necessary for another researcher to
completely re-create that project’s software environment.</li>
<li>Understand how to use Conda and Pip together effectively.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-04-sharing-environments"><p>Content from <a href="04-sharing-environments.html">Sharing Environments</a></p>
<hr>
<p>Last updated on 2024-11-14 |

        <a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/edit/main/episodes/04-sharing-environments.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 45 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Why should I share my Conda environment with others?</li>
<li>How do I share my Conda environment with others?</li>
<li>How do I create a custom kernel for my Conda environments inside
JupyterLab?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create an environment from a YAML file that can be read by Windows,
Mac OS, or Linux.</li>
<li>Create an environment based on exact package versions.</li>
<li>Create a custom kernel for a Conda environment for use inside
JupyterLab and Jupyter notebooks.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="working-with-environment-files">Working with environment files<a class="anchor" aria-label="anchor" href="#working-with-environment-files"></a>
</h2>
<hr class="half-width">
<p>When working on a collaborative research project it is often the case
that your operating system might differ from the operating systems used
by your collaborators. Similarly, the operating system used on a remote
cluster to which you have access will likely differ from the operating
system that you use on your local machine. In these cases it is useful
to create an operating system agnostic environment file which you can
share with collaborators or use to re-create an environment on a remote
cluster.</p>
<div class="section level3">
<h3 id="creating-an-environment-file">Creating an environment file<a class="anchor" aria-label="anchor" href="#creating-an-environment-file"></a>
</h3>
<p>In order to make sure that your environment is truly shareable, you
need to make sure that that the contents of your environment are
described in such a way that the resulting environment file can be used
to re-create your environment on Linux, Mac OS, and Windows. Conda uses
YAML (“YAML Ain’t Markup Language”) for writing its environment files.
YAML is a human-readable data-serialization language that is commonly
used for configuration files and that uses Python-style indentation to
indicate nesting.</p>
<p>Creating your project’s Conda environment from a single environment
file is a Conda “best practice”. Not only do you have a file to share
with collaborators but you also have a file that can be placed under
version control which further enhancing the reproducibility of your
research project and workflow.</p>
<div id="default-environment.yml-file" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="default-environment.yml-file" class="callout-inner">
<h3 class="callout-title">Default <code>environment.yml</code> file</h3>
<div class="callout-content">
<p>Note that by convention Conda environment files are called
<code>environment.yml</code>. As such if you use the
<code>conda env create</code> sub-command without passing the
<code>--file</code> option, then <code>conda</code> will expect to find
a file called <code>environment.yml</code> in the current working
directory and will throw an error if a file with that name can not be
found.</p>
</div>
</div>
</div>
<p>Let’s take a look at a few example <code>environment.yml</code> files
to give you an idea of how to write your own environment files.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> machine-learning-env</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> ipython</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> matplotlib</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> scikit-learn</span></span></code></pre>
</div>
<p>This <code>environment.yml</code> file would create an environment
called <code>machine-learning-env</code> with the most current and
mutually compatible versions of the listed packages (including all
required dependencies). The newly created environment would be installed
inside the <code>~/miniconda3/envs/</code> directory, unless we
specified a different path using <code>--prefix</code>.</p>
<p>Since explicit versions numbers for all packages should be preferred
a better environment file would be the following.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> machine-learning-env</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> ipython=7.13</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> matplotlib=3.1</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas=1.0</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.0</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.6</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> scikit-learn=0.22</span></span></code></pre>
</div>
<p>Note that we are only specifying the major and minor version numbers
and not the patch or build numbers. Defining the version number by
fixing only the major and minor version numbers while allowing the patch
version number to vary allows us to use our environment file to update
our environment to get any bug fixes whilst still maintaining
significant consistency of our Conda environment across updates.</p>
<div id="always-version-control-your-environment.yml-files" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="always-version-control-your-environment.yml-files" class="callout-inner">
<h3 class="callout-title">
<em>Always</em> version control your
<code>environment.yml</code> files!</h3>
<div class="callout-content">
<p>While you should <em>never</em> version control the contents of your
<code>env/</code> environment sub-directory, you should <em>always</em>
version control your <code>environment.yml</code> files. Version
controlling your <code>environment.yml</code> files together with your
project’s source code means that you always know which versions of which
packages were used to generate your results at any particular point in
time.</p>
</div>
</div>
</div>
<p>Let’s suppose that you want to use the <code>environment.yml</code>
file defined above to create a Conda environment in a sub-directory of
some project directory. Here is how you would accomplish this task.</p>
<pre><code>$ cd ~/Desktop/introduction-to-conda-for-data-scientists
$ mkdir project-dir
$ cd project-dir</code></pre>
<p>Once your project folder is created, create
<code>environment.yml</code> using your favourite editor for instance
<code>nano</code>. Finally create a new conda environment:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> conda env create <span class="at">--prefix</span> ./env <span class="at">--file</span> environment.yml</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">$</span> conda activate ./env</span></code></pre>
</div>
<p>Note that the above sequence of commands assumes that the
<code>environment.yml</code> file is stored within your
<code>project-dir</code> directory.</p>
</div>
</section><section><h2 class="section-heading" id="automatically-generate-an-environment-yml">Automatically generate an <code>environment.yml</code>
<a class="anchor" aria-label="anchor" href="#automatically-generate-an-environment-yml"></a>
</h2>
<hr class="half-width">
<p>To export the packages installed into the previously created
<code>machine-learning-env</code> you can run the following command:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> conda env export <span class="at">--name</span> machine-learning-env </span></code></pre>
</div>
<p>When you run this command, you will see the resulting YAML formatted
representation of your Conda environment streamed to the terminal.
Recall that we only listed five packages when we originally created
<code>machine-learning-env</code> yet from the output of the
<code>conda env export</code> command we see that these five packages
result in an environment with roughly 80 dependencies!</p>
<p>To export this list into an environment.yml file, you can use
<code>--file</code> option to directly save the resulting YAML
environment into a file.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> conda env export <span class="at">--name</span> machine-learning-env <span class="at">--file</span> environment.yml</span></code></pre>
</div>
<p>Make sure you do not have any other <code>environment.yml</code> file
from before in the same directory when running the above command.</p>
<p>This exported environment file will however not <em>consistently</em>
produce environments that are reproducible across Mac OS, Windows, and
Linux. The reason is, that it may include operating system specific
low-level packages which cannot be used by other operating systems.</p>
<p>If you need an environment file that can produce environments that
are reproducibile across Mac OS, Windows, and Linux, then you are better
off just including those packages into the environment file that your
have specifically installed.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> conda env export <span class="at">--name</span> machine-learning-env <span class="at">--from-history</span> <span class="at">--file</span> environment.yml</span></code></pre>
</div>
<p>In short: to make sure others can reproduce your environment
independent of the operating system they use, make sure to add the
<code>--from-history</code> argument to the
<code>conda env export</code> command.</p>
<div id="create-a-new-environment-from-a-yaml-file." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="create-a-new-environment-from-a-yaml-file." class="callout-inner">
<h3 class="callout-title">Create a new environment from a YAML file.</h3>
<div class="callout-content">
<p>Create a new project directory and then create a new
<code>environment.yml</code> file inside your project directory with the
following contents.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> scikit-learn-env</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> ipython=7.13</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> matplotlib=3.1</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas=1.0</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.0</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.6</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> scikit-learn=0.22</span></span></code></pre>
</div>
<p>Now use this file to create a new Conda environment. Where is this
new environment created? Using the same <code>environment.yml</code>
file create a Conda environment as a sub-directory called
<code>env/</code> inside a newly created project directory. Compare the
contents of the two environments.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>To create a new environment from a YAML file use the
<code>conda env create</code> sub-command as follows.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> mkdir scikit-learn-project-dir</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">$</span> cd scikit-learn-project-dir</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="ex">$</span> nano environment.yml</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="ex">$</span> conda env create <span class="at">--file</span> environment.yml</span></code></pre>
</div>
<p>The above sequence of commands will create a new Conda environment
inside the <code>~/miniconda3/envs</code> directory. In order to create
the Conda environment inside a sub-directory of the project directory
you need to pass the <code>--prefix</code> to the
<code>conda env create</code> command as follows.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> conda env create <span class="at">--file</span> environment.yml <span class="at">--prefix</span> ./env</span></code></pre>
</div>
<p>You can now run the <code>conda env list</code> command and see that
these two environments have been created in different locations but
contain the same packages.</p>
</div>
</div>
</div>
</div>
<div id="specifying-channels-in-the-environment.yml" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="specifying-channels-in-the-environment.yml" class="callout-inner">
<h3 class="callout-title">Specifying channels in the environment.yml</h3>
<div class="callout-content">
<p>We learned in the previous episode, that some packages may need to be
installed from other than the defaults channel. We can also specify the
channels, that conda should look for the packages within the
environment.yml file:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> pytorch-env</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytorch</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> defaults</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytorch=1.1</span></span></code></pre>
</div>
<p>When the above file is used to create an environment, conda would
first look in the <code>pytorch</code> channel for all packages
mentioned under <code>dependencies</code>. If they exist in the
<code>pytorch</code> channel, conda would install them from there, and
not look for them in <code>defaults</code> at all.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="updating-an-environment">Updating an environment<a class="anchor" aria-label="anchor" href="#updating-an-environment"></a>
</h3>
<p>You are unlikely to know ahead of time which packages (and version
numbers!) you will need to use for your research project. For example it
may be the case that</p>
<ul>
<li>one of your core dependencies just released a new version
(dependency version number update).</li>
<li>you need an additional package for data analysis (add a new
dependency).</li>
<li>you have found a better visualization package and no longer need to
old visualization package (add new dependency and remove old
dependency).</li>
</ul>
<p>If any of these occurs during the course of your research project,
all you need to do is update the contents of your
<code>environment.yml</code> file accordingly and then run the following
command.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> conda env update <span class="at">--prefix</span> ./env <span class="at">--file</span> environment.yml  <span class="at">--prune</span></span></code></pre>
</div>
<p>Note that the <code>--prune</code> option tells Conda to remove any
dependencies that are no longer required from the environment.</p>
<div id="rebuilding-a-conda-environment-from-scratch" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="rebuilding-a-conda-environment-from-scratch" class="callout-inner">
<h3 class="callout-title">Rebuilding a Conda environment from scratch</h3>
<div class="callout-content">
<p>When working with <code>environment.yml</code> files it is often just
as easy to rebuild the Conda environment from scratch whenever you need
to add or remove dependencies. To rebuild a Conda environment from
scratch you can pass the <code>--force</code> option to the
<code>conda env create</code> command which will remove any existing
environment directory before rebuilding it using the provided
environment file.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> conda env create <span class="at">--prefix</span> ./env <span class="at">--file</span> environment.yml <span class="at">--force</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="add-dask-to-the-environment-to-scale-up-your-analytics" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="add-dask-to-the-environment-to-scale-up-your-analytics" class="callout-inner">
<h3 class="callout-title">Add Dask to the environment to scale up your analytics</h3>
<div class="callout-content">
<p>Add to the <code>scikit-env</code> environment file and update the
environment. <a href="https://dask.org/" class="external-link">Dask</a> provides advanced
parallelism for data science workflows enabling performance at scale for
the core Python data science tools such as Numpy Pandas, and
Scikit-Learn.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>The <code>environment.yml</code> file should now look as follows.</p>
<pre><code><span><span class="va">name</span><span class="op">:</span> <span class="va">scikit</span><span class="op">-</span><span class="va">learn</span><span class="op">-</span><span class="va">env</span></span>
<span></span>
<span><span class="va">dependencies</span><span class="op">:</span></span>
<span>  <span class="op">-</span> <span class="va">dask</span><span class="op">=</span><span class="fl">2.16</span></span>
<span>  <span class="op">-</span> <span class="va">dask</span><span class="op">-</span><span class="va">ml</span><span class="op">=</span><span class="fl">1.4</span></span>
<span>  <span class="op">-</span> <span class="va">ipython</span><span class="op">=</span><span class="fl">7.13</span></span>
<span>  <span class="op">-</span> <span class="va">matplotlib</span><span class="op">=</span><span class="fl">3.1</span></span>
<span>  <span class="op">-</span> <span class="va">pandas</span><span class="op">=</span><span class="fl">1.0</span></span>
<span>  <span class="op">-</span> <span class="va">pip</span><span class="op">=</span><span class="fl">20.0</span></span>
<span>  <span class="op">-</span> <span class="va">python</span><span class="op">=</span><span class="fl">3.6</span></span>
<span>  <span class="op">-</span> <span class="va">scikit</span><span class="op">-</span><span class="va">learn</span><span class="op">=</span><span class="fl">0.22</span></span></code></pre>
<p>You could use the following command, that will rebuild the
environment from scratch with the new Dask dependencies:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> conda env create <span class="at">--prefix</span> ./env <span class="at">--file</span> environment.yml <span class="at">--force</span> </span></code></pre>
</div>
<p>Or, if you just want to update the environment in-place with the new
Dask dependencies, you can use:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">$</span> conda env update <span class="at">--prefix</span> ./env <span class="at">--file</span> environment.yml  <span class="at">--prune</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="installing-via-pip-in-environment.yml-files" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="installing-via-pip-in-environment.yml-files" class="callout-inner">
<h3 class="callout-title">Installing via <code>pip</code> in
<code>environment.yml</code> files</h3>
<div class="callout-content">
<p>Since you write <code>environment.yml</code> files for all of your
projects, you might be wondering how to specify that packages should be
installed using <code>pip</code> in the <code>environment.yml</code>
file. Here is an example <code>environment.yml</code> file that uses
<code>pip</code> to install the <code>kaggle</code> and
<code>yellowbrick</code> packages.</p>
<pre><code><span><span class="va">name</span><span class="op">:</span> <span class="va">example</span></span>
<span></span>
<span><span class="va">dependencies</span><span class="op">:</span></span>
<span> <span class="op">-</span> <span class="va">jupyterlab</span><span class="op">=</span><span class="fl">1.0</span></span>
<span> <span class="op">-</span> <span class="va">matplotlib</span><span class="op">=</span><span class="fl">3.1</span></span>
<span> <span class="op">-</span> <span class="va">pandas</span><span class="op">=</span><span class="fl">0.24</span></span>
<span> <span class="op">-</span> <span class="va">scikit</span><span class="op">-</span><span class="va">learn</span><span class="op">=</span><span class="fl">0.21</span></span>
<span> <span class="op">-</span> <span class="va">pip</span><span class="op">=</span><span class="fl">19.1</span></span>
<span> <span class="op">-</span> <span class="va">pip</span><span class="op">:</span></span>
<span>   <span class="op">-</span> <span class="va">kaggle</span><span class="op">==</span><span class="fl">1.5</span></span>
<span>   <span class="op">-</span> <span class="va">yellowbrick</span><span class="op">==</span><span class="fl">0.9</span></span></code></pre>
<p>Note the double ‘==’ instead of ‘=’ for the pip installation and that
you should include <code>pip</code> itself as a dependency and then a
subsection denoting those packages to be installed via <code>pip</code>.
Also in case you are wondering, The <a href="https://www.scikit-yb.org/en/latest/" class="external-link">Yellowbrick</a> package is a
suite of visual diagnostic tools called “Visualizers” that extend the <a href="https://scikit-learn.org/stable/" class="external-link">Scikit-Learn</a> API to allow
human steering of the model selection process. Recent version of
yellowbrick can also be installed using <code>conda</code> from the
<code>conda-forge</code> channel.</p>
<pre><code>$ conda install --channel conda-forge yellowbrick=1.2 --prefix ./env</code></pre>
<p>An alternative way of installing dependencies via <code>pip</code> in
your environment files is to store all the packages that you wish to
install via <code>pip</code> in a <code>requirements.txt</code> file and
then add the following to your <code>environment.yml file</code>.</p>
<pre><code>...
  - pip
  - pip:
    - -r file:requirements.txt</code></pre>
<p>Conda will then install your <code>pip</code> dependencies using
<code>python -m pip install -r requirements.txt</code> (after creating
the Conda environment and installing all Conda installable
dependencies).</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="making-jupyter-aware-of-your-conda-environments">Making Jupyter aware of your Conda environments<a class="anchor" aria-label="anchor" href="#making-jupyter-aware-of-your-conda-environments"></a>
</h2>
<hr class="half-width">
<p>Both JupyterLab and Jupyter Notebooks automatically ensure that the
standard IPython kernel is always available by default. However, if you
want to use a kernel based on a particular Conda environment from inside
Jupyter (and Juptyer is <em>not</em> installed inside your environment)
then will need to create a <a href="https://jupyter-client.readthedocs.io/en/latest/kernels.html#kernelspecs" class="external-link">kernel
spec</a> file for your Conda environments manually.</p>
<p>Before you can create a custom kernel for you Conda environment you
need to make sure that the <a href="https://pypi.org/project/ipykernel/" class="external-link"><code>ipykernel</code></a>
package is installed in your Conda environment as you will need to use
this package to create the kernel spec file. Here is the updated
<code>xgboost-env</code> <code>environment.yml</code> file that includes
the <code>ipykernel</code> package.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> ml-env</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> ipykernel=5.3</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> ipython=7.13</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> matplotlib=3.1</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas=1.0</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.0</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.6</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> scikit-learn=0.22</span></span></code></pre>
</div>
<p>Next, rebuild the Conda environment using the following command.</p>
<pre><code>$ conda env create --prefix ./env --file environment.yml --force</code></pre>
<p>Once the Conda environment has been re-built you can activate the
environment and then create the custom kernel for the activated
environment.</p>
<pre><code>$ conda activate ./env
$ python -m ipykernel install --user --name xgboost-env --display-name "XGBoost"</code></pre>
<p>The last command installs a kernel spec file for the current
environment. Kernel spec files are JSON files which can be viewed and
changed with a normal text editor. The <code>--name</code> value is used
by Jupyter internally; <code>--display-name</code> is what you see in
the JupyterLab launcher menu as well as the Jupyter Notebook dropdown
kernel menu. This command will overwrite any existing kernel with the
same name.</p>
<div id="create-a-kernel-for-a-conda-environment" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="create-a-kernel-for-a-conda-environment" class="callout-inner">
<h3 class="callout-title">Create a kernel for a Conda environment</h3>
<div class="callout-content">
<p>Create a custom kernel for the <code>machine-learning-env</code>
environment created in a previous challenge.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>In order to activate an existing environment by name you use the
<code>conda activate</code> command as follows.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">$</span> conda activate machine-learning-env</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="ex">$</span> python <span class="at">-m</span> ipykernel install <span class="at">--user</span> <span class="at">--name</span> machine-learning-env</span></code></pre>
</div>
<p>Note that by leaving the <code>--display-name</code> unspecified, the
display name will match the value provided to <code>--name</code> .</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Sharing Conda environments with other researchers facilitates the
reprodicibility of your research.</li>
<li>Create an<code>environment.yml</code> file that describes your
project’s software environment.</li>
<li>Creating custom kernels enables you to connect your Conda
environments to an existing JupterLab install.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-05-managing-cuda-dependencies"><p>Content from <a href="05-managing-cuda-dependencies.html">Managing GPU dependencies</a></p>
<hr>
<p>Last updated on 2024-11-14 |

        <a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/edit/main/episodes/05-managing-cuda-dependencies.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 60 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Which NVIDIA libraries are available via Conda?</li>
<li>What do you do when you need the NVIDIA CUDA Compiler (NVCC) for
your project?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Show how to use Conda to manage key GPU dependencies for you next
(data) science project.</li>
<li>Show how to identify which versions of CUDA packages are available
via Conda.</li>
<li>Understand how to write a Conda environment file for a project with
GPU dependencies.</li>
<li>Understand when you need the NVIDIA CUDA Compiler (NVCC) and how to
handle this situation.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="getting-familiar-with-nvidia-cuda-libraries">Getting familiar with NVIDIA CUDA libraries<a class="anchor" aria-label="anchor" href="#getting-familiar-with-nvidia-cuda-libraries"></a>
</h2>
<hr class="half-width">
<p>Transitioning your (data) science projects from CPU to GPU can seem
like a daunting task. In particular, there is quite a bit of unfamiliar
additional software, such as <a href="https://developer.nvidia.com/cuda-toolkit" class="external-link">NVIDIA CUDA
Toolkit</a>, <a href="https://developer.nvidia.com/nccl" class="external-link">NVIDIA
Collective Communications Library (NCCL)</a>, and <a href="https://developer.nvidia.com/cudnn" class="external-link">NVIDIA Deep Neural Network
Library (cuDNN)</a> to download and install.</p>
<p>If you go to the <a href="https://developer.nvidia.com/" class="external-link">NVIDIA
developer</a> website you will find loads of documentation and
instructions for how to install these libraries system wide. But then
what do you do if you need different versions of these new libraries for
different projects? You could install a bunch of different versions of
NVIDIA CUDA Toolkit, NCCL, and cuDNN system wide and then use
environment variables to control the “active” versions for each project
but this is cumbersome and error prone. Fortunately there are better
ways!</p>
<p>In this episode we are going to see how to manage project specific
versions of the NVIDIA CUDA Toolkit, NCCL, and cuDNN using Conda.</p>
<div class="section level3">
<h3 id="are-nvidia-libraries-available-via-conda">Are NVIDIA libraries available via Conda?<a class="anchor" aria-label="anchor" href="#are-nvidia-libraries-available-via-conda"></a>
</h3>
<p>Yep! The most important NVIDIA CUDA library that you will need is the
NVIDIA CUDA Toolkit. The NVIDIA CUDA Toolkit provides a development
environment for creating high performance GPU-accelerated applications.
The toolkit includes GPU-accelerated libraries, debugging and
optimization tools and a runtime library. You can use the
<code>conda search</code> command to see what versions of the NVIDIA
CUDA Toolkit are available from the default channels.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> conda search cudatoolkit</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">Loading</span> channels: done</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># Name                       Version           Build  Channel</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="ex">cudatoolkit</span>                      9.0      h13b8566_0  pkgs/main</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="ex">cudatoolkit</span>                      9.2               0  pkgs/main</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="ex">cudatoolkit</span>                 10.0.130               0  pkgs/main</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="ex">cudatoolkit</span>                 10.1.168               0  pkgs/main</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="ex">cudatoolkit</span>                 10.1.243      h6bb024c_0  pkgs/main</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="ex">cudatoolkit</span>                  10.2.89      hfd86e86_0  pkgs/main</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="ex">cudatoolkit</span>                  10.2.89      hfd86e86_1  pkgs/main</span></code></pre>
</div>
<p>NVIDIA actually maintains their own Conda channel and the versions of
CUDA Toolkit available from the default channels are the same as those
you will find on the NVIDIA channel. If you are interested in confirming
this you can run the command</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> conda search <span class="at">--channel</span> nvidia cudatoolkit</span></code></pre>
</div>
<p>and then compare the build numbers with those listed above from the
default channels.</p>
<div id="the-cuda-toolkit-packages-available-from-defaults-do-not-include-nvcc" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-cuda-toolkit-packages-available-from-defaults-do-not-include-nvcc" class="callout-inner">
<h3 class="callout-title">The CUDA Toolkit packages available from defaults do not include NVCC</h3>
<div class="callout-content">
<p>An important limitation of the versions of the NVIDIA CUDA Toolkit
that are available from the either the default or NVIDIA Conda channels
is that they do not include the NVIDIA CUDA Compiler (NVCC).</p>
</div>
</div>
</div>
<div class="section level4">
<h4 id="what-about-cudnn">What about cuDNN?<a class="anchor" aria-label="anchor" href="#what-about-cudnn"></a>
</h4>
<p>The <a href="https://developer.nvidia.com/cudnn" class="external-link">NVIDIA CUDA Deep
Neural Network library (cuDNN)</a> is a GPU-accelerated library of
primitives for deep neural networks. cuDNN provides highly tuned
implementations for standard routines such as forward and backward
convolution, pooling, normalization, and activation layers.</p>
<p>If you are interested in deep learning, then you will need to get
your hands on cuDNN. Various versions of cuDNN are available from the
default channels.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> conda search cudnn</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">Loading</span> channels: done</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># Name                       Version           Build  Channel</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="ex">cudnn</span>                          7.0.5       cuda8.0_0  pkgs/main</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="ex">cudnn</span>                          7.1.2       cuda9.0_0  pkgs/main</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="ex">cudnn</span>                          7.1.3       cuda8.0_0  pkgs/main</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="ex">cudnn</span>                          7.2.1       cuda9.2_0  pkgs/main</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="ex">cudnn</span>                          7.3.1      cuda10.0_0  pkgs/main</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="ex">cudnn</span>                          7.3.1       cuda9.0_0  pkgs/main</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="ex">cudnn</span>                          7.3.1       cuda9.2_0  pkgs/main</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.0      cuda10.0_0  pkgs/main</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.0      cuda10.1_0  pkgs/main</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.0       cuda9.0_0  pkgs/main</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.0       cuda9.2_0  pkgs/main</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.4      cuda10.0_0  pkgs/main</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.4      cuda10.1_0  pkgs/main</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.4       cuda9.0_0  pkgs/main</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.4       cuda9.2_0  pkgs/main</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.5      cuda10.0_0  pkgs/main</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.5      cuda10.1_0  pkgs/main</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.5      cuda10.2_0  pkgs/main</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.5       cuda9.0_0  pkgs/main</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="ex">cudnn</span>                          7.6.5       cuda9.2_0  pkgs/main</span></code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="what-about-nccl">What about NCCL?<a class="anchor" aria-label="anchor" href="#what-about-nccl"></a>
</h3>
<p>If you are already accelerating your (data) science workflows with a
GPU, then in the near future you will probably be interested in using
more than one GPU. The <a href="https://developer.nvidia.com/nccl" class="external-link">NVIDIA Collective
Communications Library (NCCL)</a> implements multi-GPU and multi-node
collective communication primitives that are performance optimized for
NVIDIA GPUs.</p>
<p>There are some older versions of NCCL available from the default
channels but these versions will not be useful (unless, perhaps, you are
forced to use very old versions of TensorFlow or similar).</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> conda search nccl</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="ex">Loading</span> channels: done</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># Name                       Version           Build  Channel</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="ex">nccl</span>                           1.3.5      cuda10.0_0  pkgs/main</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="ex">nccl</span>                           1.3.5       cuda9.0_0  pkgs/main</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="ex">nccl</span>                           1.3.5       cuda9.2_0  pkgs/main</span></code></pre>
</div>
<p>Not to worry: Conda Forge to the rescue! <a href="https://conda-forge.org/" class="external-link">Conda Forge</a> is a community-led
collection of recipes, build infrastructure and distributions for the
Conda package manager. I always check the <code>conda-forge</code>
channel when I can’t find something I need available on the default
channels.</p>
<div id="which-version-of-nccl-are-available-via-conda-forge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="which-version-of-nccl-are-available-via-conda-forge" class="callout-inner">
<h3 class="callout-title">Which version of NCCL are available via Conda Forge?</h3>
<div class="callout-content">
<p>Find out which versions of the NVIDIA Collective Communications
Library (NCCL) are available via Conda Forge?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Use the <code>conda search</code> command with the
<code>--channel conda-forge</code> option.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> conda search <span class="at">--channel</span> conda-forge nccl</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="ex">Loading</span> channels: done</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># Name                       Version           Build  Channel</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="ex">nccl</span>                           1.3.5      cuda10.0_0  pkgs/main</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="ex">nccl</span>                           1.3.5       cuda9.0_0  pkgs/main</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="ex">nccl</span>                           1.3.5       cuda9.2_0  pkgs/main</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.6.1      h51cf6c1_0  conda-forge</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.6.1      h7cc98d6_0  conda-forge</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.6.1      hc6a2c23_0  conda-forge</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.6.1      hd6f8bf8_0  conda-forge</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.7.1      h51cf6c1_0  conda-forge</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.7.1      h7cc98d6_0  conda-forge</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.7.1      hd6f8bf8_0  conda-forge</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.8.1      h51cf6c1_0  conda-forge</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.8.1      h51cf6c1_1  conda-forge</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.8.1      h7cc98d6_0  conda-forge</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.8.1      h7cc98d6_1  conda-forge</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.8.1      hd6f8bf8_0  conda-forge</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="ex">nccl</span>                         2.4.8.1      hd6f8bf8_1  conda-forge</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="ex">nccl</span>                         2.5.6.1      h51cf6c1_0  conda-forge</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="ex">nccl</span>                         2.5.6.1      h7cc98d6_0  conda-forge</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="ex">nccl</span>                         2.5.6.1      hc6a2c23_0  conda-forge</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="ex">nccl</span>                         2.5.6.1      hd6f8bf8_0  conda-forge</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="ex">nccl</span>                         2.5.7.1      h51cf6c1_0  conda-forge</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="ex">nccl</span>                         2.5.7.1      h7cc98d6_0  conda-forge</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="ex">nccl</span>                         2.5.7.1      hc6a2c23_0  conda-forge</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="ex">nccl</span>                         2.5.7.1      hd6f8bf8_0  conda-forge</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="ex">nccl</span>                         2.6.4.1      h51cf6c1_0  conda-forge</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="ex">nccl</span>                         2.6.4.1      h7cc98d6_0  conda-forge</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="ex">nccl</span>                         2.6.4.1      hc6a2c23_0  conda-forge</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="ex">nccl</span>                         2.6.4.1      hd6f8bf8_0  conda-forge</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="some-example-conda-environment-files">Some example Conda environment files<a class="anchor" aria-label="anchor" href="#some-example-conda-environment-files"></a>
</h2>
<hr class="half-width">
<p>Now that you know how to figure out which versions of the various
NVIDIA CUDA libraries are available on which channels you are ready to
write your environment.yml file. In this section I will provide some
example Conda environment files for PyTorch, TensorFlow, and NVIDIA
RAPIDS to help get you started on your next GPU data science
project.</p>
<div class="section level3">
<h3 id="pytorch">PyTorch<a class="anchor" aria-label="anchor" href="#pytorch"></a>
</h3>
<p><a href="https://pytorch.org/" class="external-link">PyTorch</a> is an open source machine
learning library based on the Torch library, used for applications such
as computer vision and natural language processing. It is primarily
developed by Facebook’s AI Research lab. Conda is actually the <a href="https://pytorch.org/get-started/locally/" class="external-link">recommended way</a> to
install PyTorch. The official PyTorch binary ships with NCCL and cuDNN
so it is not necessary to include these libraries in your
<code>environment.yml</code> file (unless some other package also needs
these libraries!).</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytorch</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> conda-forge</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> defaults</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cudatoolkit=10.1</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.0</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.7</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytorch=1.5</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> torchvision=0.6</span></span></code></pre>
</div>
<div id="check-your-channel-priorities" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="check-your-channel-priorities" class="callout-inner">
<h3 class="callout-title">Check your channel priorities!</h3>
<div class="callout-content">
<p>Also take note of the channel priorities: the official
<code>pytorch</code> channel must be given priority over
<code>conda-forge</code> in order to insure that the official PyTorch
binaries (the ones that include NCCL and cuDNN) will be installed
(otherwise you will get some unofficial version of PyTorch available on
<code>conda-forge</code>).</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="tensorflow">TensorFlow<a class="anchor" aria-label="anchor" href="#tensorflow"></a>
</h3>
<p><a href="https://www.tensorflow.org/" class="external-link">TensorFlow</a> is a free,
open-source software library for dataflow and differentiable programming
across a range of tasks. It is a symbolic math library, and is also used
for machine learning applications such as neural networks. There are
lots of versions and builds of TensorFlow available via Conda (the
output of <code>conda search tensorflow</code> is too long to share
here!).</p>
<p>How do you decide which version is the “correct” version? How to make
sure that you get a build that includes GPU support? At this point you
have seen all the Conda “tricks” required to solve this one
yourself!</p>
<div id="create-an-environment.yml-file-for-tensorflow" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="create-an-environment.yml-file-for-tensorflow" class="callout-inner">
<h3 class="callout-title">Create an <code>environment.yml</code> file
for TensorFlow</h3>
<div class="callout-content">
<p>In this exercise you will create a Conda environment for TensorFlow.
Important CUDA dependencies of TensorFlow are the CUDA Toolkit, cuDNN,
and <a href="https://docs.nvidia.com/cuda/cupti/index.html" class="external-link">CUPTI</a>.
Don’t forget that if you want to train on more than one GPU, then your
environment will also need NCCL and an MPI implementation.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Use the <code>tensorflow-gpu</code> meta-package to select the
appropriate version and build of TensorFlow for your OS; use <a href="https://mpi4py.readthedocs.io/en/stable/" class="external-link"><code>mpi4py</code></a>
to get a CUDA-aware OpenMPI build.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> conda-forge</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> defaults</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cudatoolkit=10.1</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cudnn=7.6</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cupti=10.1</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> mpi4py=3.0</span><span class="co"> # installs cuda-aware openmpi</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> nccl=2.4</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.0</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.7</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> tensorflow-gpu=2.1</span><span class="co"> # installs tensorflow=2.1=gpu_py37h7a4bb67_0</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="nvidia-rapids-blazingsqldatashader">NVIDIA RAPIDS (+BlazingSQL+Datashader)<a class="anchor" aria-label="anchor" href="#nvidia-rapids-blazingsqldatashader"></a>
</h3>
<p>As a final example let’s see how to get started with <a href="https://rapids.ai/" class="external-link">NVIDIA RAPIDS</a> (and friends!). NVIDIA
RAPIDS is a suite of open source software libraries and APIs gives you
the ability to execute end-to-end data science and analytics pipelines
entirely on GPUs (think <a href="https://pandas.pydata.org/" class="external-link">Pandas</a>
+ <a href="https://scikit-learn.org/stable/index.html" class="external-link">Scikit-learn</a>
but for GPUs instead of CPUs). In addition to RAPIDS we have also
included <a href="https://www.blazingsql.com/" class="external-link">BlazingSQL</a> in this
example environment file. BlazingSQL is an open-source SQL interface to
extract-transform-load (ETL) massive datasets directly into GPU memory
for analysis using NVIDIA RAPIDS. The environment also includes <a href="https://datashader.org/" class="external-link">Datashader</a>, a graphics pipeline
system for creating meaningful representations of large datasets quickly
and flexibly, that can be accelerated with GPUs. If you are going to do
all of your data analysis on the GPU, then you might as well do your
data visualization on the GPU too!</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span><span class="at"> </span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span><span class="at">  </span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> blazingsql</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> rapidsai</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> nvidia</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> conda-forge</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> defaults</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span><span class="at">  </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> blazingsql=0.13</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cudatoolkit=10.1</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> datashader=0.10</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.0</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.7</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> rapids=0.13</span></span></code></pre>
</div>
<div id="what-exactly-is-installed-when-you-install-nvidia-rapids" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="what-exactly-is-installed-when-you-install-nvidia-rapids" class="callout-inner">
<h3 class="callout-title">What exactly is installed when you install NVIDIA RAPIDS?</h3>
<div class="callout-content">
<p>Create an NVIDIA RAPIDS environment using the Conda environment file
above. Use Conda commands to inspect the complete list of packages that
have been installed. Do you recognize any of the packages?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Use the following commands to create the environment.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> mkdir nvidia-rapids-project</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">$</span> cd nvidia-rapids-project/</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="ex">$</span> nano environment.yml <span class="co"># copy-paste the environment file contents</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="ex">$</span> conda env create <span class="at">--prefix</span> ./env <span class="at">--file</span> environment.yml</span></code></pre>
</div>
<p>Use the following commands to activate the environment and list all
the packages installed.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> conda activate ./env</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">$</span> conda list</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="but-what-if-i-need-the-nvidia-cuda-compiler">But what if I need the NVIDIA CUDA Compiler?<a class="anchor" aria-label="anchor" href="#but-what-if-i-need-the-nvidia-cuda-compiler"></a>
</h2>
<hr class="half-width">
<p>Way up at the beginning of this lesson I mentioned that the versions
of the NVIDIA CUDA Toolkit available via the default channels did not
include the NVIDIA CUDA Compiler (NVCC). However, if your data science
project has dependencies that require compiling custom CUDA extensions
then you will almost surely need the NVIDIA CUDA Compiler (NVCC).</p>
<p>How do you know that your project dependencies need NVCC? Most likely
you will try the standard approaches above and Conda will fail to
successfully create the environment and perhaps throw a bunch of
compiler errors. Once you know that you need NVCC, there are a couple of
ways to get the NVCC compiler installed.</p>
<div class="section level3">
<h3 id="first-try-the-cudatoolkit-dev-package">First, try the <code>cudatoolkit-dev</code> package…<a class="anchor" aria-label="anchor" href="#first-try-the-cudatoolkit-dev-package"></a>
</h3>
<p>The cudatoolkit-dev package available from the conda-forge channel
includes GPU-accelerated libraries, debugging and optimization tools, a
C/C++ compiler and a runtime library. This package consists of a
post-install script that downloads and installs the full CUDA toolkit
(NVCC compiler and libraries, but not the exception of CUDA
drivers).</p>
<p>While the cudatoolkit-dev packages available from conda-forge do
include NVCC, I have had difficulties getting these packages to
consistently install properly.</p>
<ul>
<li>Some of the available builds require manual intervention to accept
license agreements making these builds unsuitable for installing on
remote systems (which is critical functionality).</li>
<li>Some other builds seem to work on Ubuntu but not on other flavors of
Linux such as CentOS.</li>
<li>Other Conda packages that depend on CUDA will often install the
cudatoolkit package even though everything included in this package will
have already been installed via cudatoolkit-dev.</li>
</ul>
<p>That said, it is always worth trying the <code>cudatoolkit-dev</code>
approach first. Maybe it will work for your use case. Here is an example
that uses NVCC installed via the cudatoolkit-dev package to compile
custom extensions from <a href="https://github.com/rusty1s/pytorch_cluster" class="external-link">PyTorch Cluster</a>, a
small extension library of highly optimized graph cluster algorithms for
the use with <a href="https://pytorch.org/" class="external-link">PyTorch</a>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytorch</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> conda-forge</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> defaults</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cudatoolkit-dev=10.1</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cxx-compiler=1.0</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> matplotlib=3.2</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> networkx=2.4</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> numba=0.48</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas=1.0</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.0</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">pip</span><span class="kw">:</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -r file:requirements.txt</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.7</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytorch=1.4</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> scikit-image=0.16</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> scikit-learn=0.22</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> tensorboard=2.1</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> torchvision=0.5</span></span></code></pre>
</div>
<p>The <code>requirements.txt</code> file referenced above contains
PyTorch Cluster and related packages such as <a href="https://github.com/rusty1s/pytorch_geometric" class="external-link">PyTorch
Geometric</a>. Here is what that file looks like.</p>
<pre><code>torch-scatter==2.0.*
torch-sparse==0.6.*
torch-spline-conv==1.2.*
torch-cluster==1.5.*
torch-geometric==1.4.*

# make sure the following are re-compiled if environment is re-built
--no-binary=torch-scatter
--no-binary=torch-sparse
--no-binary=torch-spline-conv
--no-binary=torch-cluster
--no-binary=torch-geometric</code></pre>
<p>The use of the <code>--no-binary</code> option here insures that the
packages with custom extensions will be re-built whenever the
environment is re-built which helps increase the reproducibility of the
environment build process when porting from workstations to remote
clusters that might have different OS.</p>
</div>
<div class="section level3">
<h3 id="if-that-doesnt-work-then-use-the-nvcc_linux-64-meta-package">…if that doesn’t work, then use the <code>nvcc_linux-64</code>
meta-package<a class="anchor" aria-label="anchor" href="#if-that-doesnt-work-then-use-the-nvcc_linux-64-meta-package"></a>
</h3>
<p>The most robust approach to obtain NVCC and still use Conda to manage
all the other dependencies is to install the NVIDIA CUDA Toolkit on your
system and then install a meta-package nvcc_linux-64 from conda-forge
which configures your Conda environment to use the NVCC installed on
your system together with the other CUDA Toolkit components installed
inside the Conda environment. While we have found this approach to be
more robust then relying on <code>cudatoolkit-dev</code>, this approach
is more involved as it requires installing a <a href="https://developer.nvidia.com/cuda-toolkit-archive" class="external-link">particular
version</a> of the NVIDIA CUDA Toolkit on your system first.</p>
<p>In order to demonstrate how to use the <code>nvcc_linux-64</code>
meta-package approach we will show how to build a Conda environment for
deep learning projects that use Horovod to enable distributed training
across multiple GPUs (either on the same node or spread across multiple
nodes).</p>
<p><a href="https://github.com/horovod/horovod" class="external-link">Horovod</a> is an
open-source distributed training framework for <a href="https://www.tensorflow.org/" class="external-link">TensorFlow</a>, <a href="https://keras.io/" class="external-link">Keras</a>, <a href="https://pytorch.org/" class="external-link">PyTorch</a>, and <a href="https://mxnet.incubator.apache.org/" class="external-link">Apache MXNet</a>. Originally
developed by Uber for in-house use, Horovod was open sourced a couple of
years ago and is now an official <a href="https://lfai.foundation/" class="external-link">Linux Foundation AI (LFAI)</a>
project.</p>
<div class="section level4">
<h4 id="typical-environment-yml-file">Typical <code>environment.yml</code> file<a class="anchor" aria-label="anchor" href="#typical-environment-yml-file"></a>
</h4>
<p>Let’s checkout the <code>environment.yml</code> file. You can find
this <code>environment.yml</code> file on GitHub as a part of a <a href="https://github.com/kaust-vislab/horovod-gpu-data-science-project" class="external-link">template
repository</a> to help you get started with Horovod.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytorch</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> conda-forge</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> defaults</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> bokeh=1.4</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cmake=3.16</span><span class="co"> # insures that Gloo library extensions will be built</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cudnn=7.6</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cupti=10.1</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cxx-compiler=1.0</span><span class="co"> # insures C and C++ compilers are available</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> jupyterlab=1.2</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> mpi4py=3.0</span><span class="co"> # installs cuda-aware openmpi</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> nccl=2.5</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> nodejs=13</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> nvcc_linux-64=10.1</span><span class="co"> # configures environment to be "cuda-aware"</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.0</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">pip</span><span class="kw">:</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> mxnet-cu101mkl==1.6.*</span><span class="co"> # MXNET is installed prior to horovod</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> -r file:requirements.txt</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.7</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pytorch=1.4</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> tensorboard=2.1</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> tensorflow-gpu=2.1</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> torchvision=0.5</span></span></code></pre>
</div>
<p>Take note of the channel priorities: <code>pytorch</code> is given
highest priority in order to insure that the official PyTorch binary is
installed (and not the binaries available on <code>conda-forge</code>).
There are also a few things worth noting about the dependencies. Even
though you have installed the NVIDIA CUDA Toolkit manually you can still
use Conda to manage the other required CUDA components such as
<code>cudnn</code> and <code>nccl</code> (and the optional
<code>cupti</code>).</p>
<ul>
<li>We use two meta-packages, <code>cxx-compiler</code> and
<code>nvcc_linux-64</code>, to make sure that suitable C, and C++
compilers are installed and that the resulting Conda environment is
aware of the manually installed CUDA Toolkit.</li>
<li>Horovod requires some controller library to coordinate work between
the various Horovod processes. Typically this will be some MPI
implementation such as OpenMPI. However, rather than specifying the
<code>openmpi</code> package directly, opt for <code>mpi4py</code> Conda
package which will install a CUDA-aware build of OpenMPI (assuming it is
supported by your hardware).</li>
<li>Horovod also supports the Gloo collective communications library
that can be used in place of MPI. If you include <code>cmake</code> in
order to insure that the Horovod extensions for Gloo are built.</li>
</ul>
</div>
<div class="section level4">
<h4 id="typical-requirements-txt-file">Typical <code>requirements.txt</code> file<a class="anchor" aria-label="anchor" href="#typical-requirements-txt-file"></a>
</h4>
<p>The <code>requirements.txt</code> file is where all of the
dependencies, including Horovod itself, are listed for installation via
<code>pip</code>. In addition to Horovod, it is recommended to use
<code>pip</code> to install JupyterLab extensions to enable GPU and CPU
resource monitoring via <a href="https://github.com/rapidsai/jupyterlab-nvdashboard" class="external-link"><code>jupyterlab-nvdashboard</code></a>
and <a href="https://www.tensorflow.org/tensorboard/" class="external-link">Tensorboard</a>
support via <a href="https://github.com/chaoleili/jupyterlab_tensorboard" class="external-link"><code>jupyter-tensorboard</code></a>.
Note the use of the <code>--no-binary</code> option at the end of the
file. Including this option insures that Horovod will be re-built
whenever the Conda environment is re-built.</p>
<pre><code>horovod==0.19.*
jupyterlab-nvdashboard==0.2.*
jupyter-tensorboard==0.2.*

# make sure horovod is re-compiled if environment is re-built
--no-binary=horovod</code></pre>
</div>
<div class="section level4">
<h4 id="creating-the-conda-environment">Creating the Conda environment<a class="anchor" aria-label="anchor" href="#creating-the-conda-environment"></a>
</h4>
<p>You can create the Conda environment in a sub-directory
<code>env</code> of your project directory by running the following
commands. By default Horovod will try and build extensions for all
detected frameworks. See the <a href="https://horovod.readthedocs.io/en/stable/" class="external-link">Horovod
documentation</a> on for the details on additional environment variables
that can be set prior to building Horovod.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">ENV_PREFIX</span><span class="op">=</span><span class="va">$PWD</span>/env</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="bu">export</span> <span class="va">HOROVOD_CUDA_HOME</span><span class="op">=</span><span class="va">$CUDA_HOME</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="bu">export</span> <span class="va">HOROVOD_NCCL_HOME</span><span class="op">=</span><span class="va">$ENV_PREFIX</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="bu">export</span> <span class="va">HOROVOD_GPU_OPERATIONS</span><span class="op">=</span>NCCL</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">--prefix</span> <span class="va">$ENV_PREFIX</span> <span class="at">--file</span> environment.yml <span class="at">--force</span></span></code></pre>
</div>
<div id="wrap-complex-conda-environment-builds-in-a-script" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="wrap-complex-conda-environment-builds-in-a-script" class="callout-inner">
<h3 class="callout-title">Wrap complex Conda environment builds in a script!</h3>
<div class="callout-content">
<p>In order to enhance reproducibility of your complex Conda build, I
typically wrap commands into a shell script called
<code>create-conda-env.sh</code>. Running the shell script will set the
Horovod build variables, create the Conda environment, activate the
Conda environment, and build JupyterLab with any additional extensions
as specified in a <code>postBuild</code> script.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co">#!/bin/bash --login</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="bu">set</span> <span class="at">-e</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="bu">export</span> <span class="va">ENV_PREFIX</span><span class="op">=</span><span class="va">$PWD</span>/env</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="bu">export</span> <span class="va">HOROVOD_CUDA_HOME</span><span class="op">=</span><span class="va">$CUDA_HOME</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="bu">export</span> <span class="va">HOROVOD_NCCL_HOME</span><span class="op">=</span><span class="va">$ENV_PREFIX</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="bu">export</span> <span class="va">HOROVOD_GPU_OPERATIONS</span><span class="op">=</span>NCCL</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">--prefix</span> <span class="va">$ENV_PREFIX</span> <span class="at">--file</span> environment.yml <span class="at">--force</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="ex">conda</span> activate <span class="va">$ENV_PREFIX</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="bu">.</span> postBuild</span></code></pre>
</div>
<p>You can put scripts inside a <code>bin</code> directory in my project
root directory. The script should be run from the project root directory
as follows.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> ./bin/create-conda-env.sh</span></code></pre>
</div>
</div>
</div>
</div>
<p>We covered a lot of ground in this lesson! We showed you how to use
<code>conda search</code> to see which versions of the NVIDIA CUDA
Toolkit and related libraries such as NCCL and cuDNN were available via
Conda. Then we walked you through example Conda environment files for
several popular data science frameworks that can use GPUs. We wrapped up
with a discussion of two different approaches for getting NVCC when your
project requires compiler custom CUDA extensions. Hopefully these ideas
will help you make the jump from CPUs to GPUs on your next data science
project!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Conda can be used to manage your key GPU dependencies.</li>
<li>Use <code>conda search</code> to identify which version of CUDA
libraries are available.</li>
<li>For most projects you will not need NVCC and can use the
<code>cudatoolkit</code> package from default channels.</li>
<li>If your project does need NVCC, try <code>cudatoolkit-dev</code>
package or <code>nvcc_linux-64</code> meta-package (requires separate
NVIDIA CUDA Toolkit install).</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/introduction-to-conda-for-data-scientists/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:david.pugh@kaust.edu.sa">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/introduction-to-conda-for-data-scientists/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/introduction-to-conda-for-data-scientists/instructor/aio.html",
  "identifier": "https://carpentries-incubator.github.io/introduction-to-conda-for-data-scientists/instructor/aio.html",
  "dateCreated": "2019-05-19",
  "dateModified": "2024-11-14",
  "datePublished": "2024-11-14"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

